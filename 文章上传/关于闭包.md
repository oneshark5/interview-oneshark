# å…³äºé—­åŒ…
æè¿°ï¼šé—­åŒ…è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ªå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å…¶å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸ


é—­åŒ…å°±æ˜¯ä¸ºäº†ä¿æŠ¤æ–¹æ³•ï¼Œä¸å‘å¤–æš´éœ²

![img](../../../%E9%A1%B9%E7%9B%AE/Serverless%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/blogImg/c141a030-6a7a-11eb-ab90-d9ae814b240d-1655434927273.png)

## ä¸€ã€æ˜¯ä»€ä¹ˆ

ä¸€ä¸ªå‡½æ•°å’Œå¯¹å…¶å‘¨å›´çŠ¶æ€ï¼ˆlexical environmentï¼Œè¯æ³•ç¯å¢ƒï¼‰çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·ï¼ˆæˆ–è€…è¯´å‡½æ•°è¢«å¼•ç”¨åŒ…å›´ï¼‰ï¼Œè¿™æ ·çš„ç»„åˆå°±æ˜¯é—­åŒ…ï¼ˆclosureï¼‰

ä¹Ÿå°±æ˜¯è¯´ï¼Œé—­åŒ…è®©ä½ å¯ä»¥åœ¨ä¸€ä¸ªå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å…¶å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸ

åœ¨ `JavaScript`ä¸­ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œé—­åŒ…å°±ä¼šåœ¨å‡½æ•°åˆ›å»ºçš„åŒæ—¶è¢«åˆ›å»ºå‡ºæ¥ï¼Œä½œä¸ºå‡½æ•°å†…éƒ¨ä¸å¤–éƒ¨è¿æ¥èµ·æ¥çš„ä¸€åº§æ¡¥æ¢ã€‚

ğŸ¦ˆé—­åŒ…æŒ‡çš„æ˜¯é‚£äº›å¼•ç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚

1. å¦‚ä½•äº§ç”Ÿé—­åŒ…?

- å½“ä¸€ä¸ªåµŒå¥—çš„å†…éƒ¨(å­)å‡½æ•°å¼•ç”¨äº†åµŒå¥—çš„å¤–éƒ¨(çˆ¶)å‡½æ•°çš„å˜é‡(å‡½æ•°)æ—¶, å°±äº§ç”Ÿäº†é—­åŒ…

2. é—­åŒ…åˆ°åº•æ˜¯ä»€ä¹ˆ?

- ä½¿ç”¨chromeè°ƒè¯•æŸ¥çœ‹
  - ç†è§£ä¸€: é—­åŒ…æ˜¯åµŒå¥—çš„å†…éƒ¨å‡½æ•°(ç»å¤§éƒ¨åˆ†äºº)
  - ç†è§£äºŒ: åŒ…å«è¢«å¼•ç”¨å˜é‡(å‡½æ•°)çš„å¯¹è±¡(æå°‘æ•°äºº)
  - æ³¨æ„: é—­åŒ…å­˜åœ¨äºåµŒå¥—çš„å†…éƒ¨å‡½æ•°ä¸­

3. äº§ç”Ÿé—­åŒ…çš„æ¡ä»¶?

- å‡½æ•°åµŒå¥—
- å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„æ•°æ®(å˜é‡/å‡½æ•°) 

ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•çš„ä¾‹å­

```js
function init() {
    var name = "Mozilla"; // name æ˜¯ä¸€ä¸ªè¢« init åˆ›å»ºçš„å±€éƒ¨å˜é‡
    function displayName() { // displayName() æ˜¯å†…éƒ¨å‡½æ•°ï¼Œä¸€ä¸ªé—­åŒ…
        alert(name); // ä½¿ç”¨äº†çˆ¶å‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼Œå½¢æˆé—­åŒ…
    }
    displayName();
}
init();
```

`displayName()` æ²¡æœ‰è‡ªå·±çš„å±€éƒ¨å˜é‡ã€‚ç„¶è€Œï¼Œç”±äºé—­åŒ…çš„ç‰¹æ€§ï¼Œå®ƒå¯ä»¥è®¿é—®åˆ°å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚

## äºŒã€ä½¿ç”¨åœºæ™¯

ä»»ä½•é—­åŒ…çš„ä½¿ç”¨åœºæ™¯éƒ½ç¦»ä¸å¼€è¿™ä¸¤ç‚¹ï¼š

- åˆ›å»ºç§æœ‰å˜é‡
- å»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ

> ä¸€èˆ¬å‡½æ•°çš„è¯æ³•ç¯å¢ƒåœ¨å‡½æ•°è¿”å›åå°±è¢«é”€æ¯ï¼Œä½†æ˜¯é—­åŒ…ä¼šä¿å­˜å¯¹åˆ›å»ºæ—¶æ‰€åœ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼Œå³ä¾¿åˆ›å»ºæ—¶æ‰€åœ¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«é”€æ¯ï¼Œä½†åˆ›å»ºæ—¶æ‰€åœ¨è¯æ³•ç¯å¢ƒä¾ç„¶å­˜åœ¨ï¼Œä»¥è¾¾åˆ°å»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸçš„ç›®çš„ã€‚

ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼š

åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€äº›å¯ä»¥è°ƒæ•´å­—å·çš„æŒ‰é’®

```js
function makeSizer(size) {
  return function() {
    document.body.style.fontSize = size + 'px';
  };
}

var size12 = makeSizer(12);
var size14 = makeSizer(14);
var size16 = makeSizer(16);

document.getElementById('size-12').onclick = size12;
document.getElementById('size-14').onclick = size14;
document.getElementById('size-16').onclick = size16;
```

### 1. æŸ¯é‡ŒåŒ–å‡½æ•°

é«˜é˜¶å‡½æ•°ï¼šä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚

æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œå‡½æ•°æ‰§è¡Œäº§ç”Ÿä¸€ä¸ªé—­åŒ…ï¼ŒæŠŠä¸€äº›ä¿¡æ¯é¢„å…ˆå­˜å‚¨èµ·æ¥ï¼Œç›®çš„æ˜¯ä¾›ä¸‹çº§ä¸Šä¸‹æ–‡ä½¿ç”¨ã€‚è¿™æ ·é¢„å…ˆå­˜å‚¨å’Œå¤„ç†çš„æ€æƒ³ï¼Œå°±å«åšæŸ¯é‡ŒåŒ–çš„ç¼–ç¨‹æ€æƒ³ã€‚

ç®€å•æ¥è¯´å°±æ˜¯åªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒ==è¿”å›ä¸€ä¸ªå‡½æ•°==å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚

```js
// å®šä¹‰äº†ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°ï¼Œå½“ä¼ å…¥å‚æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªè®°å½•widthçš„heightå‡½æ•°
function getArea(width) {
  return height => {
    return width * height
  }
}

// è°ƒç”¨getAreaå‡½æ•°è¿”å›ä¸€ä¸ªå‡½æ•°ç»™getWidthAreaï¼Œå…¶ä¸­è®°å½•ç€ä¼ å…¥çš„widthå‚æ•°
const getWidthArea = getArea(10)

// getWidthAreaå‡½æ•°åˆæ¥æ”¶ä¸€ä¸ªheightå‚æ•°
const areaRes = getWidthArea(20)//
console.log(areaRes); // 200
```

æŸ¯é‡ŒåŒ–å‡½æ•°é¢è¯•é¢˜

add(1)(2)(3)(4)(5)(6); // => 21
add(1, 2)(3, 4)(5, 6); // => 21
add(1, 2, 3, 4, 5, 6); // => 21

[ç­”æ¡ˆ](https://juejin.cn/post/7086393986780233736#comment)

```js
var curring = () => {
  var result = [];
  var add = (...args) => {
    result = result.concat(args);
    return add;
  };

  add.valueOf = add.toString = () => {
    return result.reduce((pre, cur) => pre + cur, 0);
  }
  return add;
};

var add = curring();
console.log(+add(1)(2)(3)(4)(5)(6));

add = curring();
console.log(+add(1, 2)(3, 4)(5, 6));

add = curring();
console.log(+add(1, 2, 3, 4, 5, 6));
```

## 2. ä½¿ç”¨é—­åŒ…æ¨¡æ‹Ÿç§æœ‰æ–¹æ³•

å°±æ˜¯å®šä¹‰JSæ¨¡å—

- å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„jsæ–‡ä»¶
- å°†æ‰€æœ‰çš„æ•°æ®å’ŒåŠŸèƒ½éƒ½å°è£…åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨(ç§æœ‰çš„)
- åªå‘å¤–æš´éœ²ä¸€ä¸ªåŒ…å«nä¸ªæ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°
- æ¨¡å—çš„ä½¿ç”¨è€…, åªéœ€è¦é€šè¿‡æ¨¡å—æš´éœ²çš„å¯¹è±¡è°ƒç”¨æ–¹æ³•æ¥å®ç°å¯¹åº”çš„åŠŸèƒ½

ä¸¤ç§å®šä¹‰æ–¹æ³•ï¼šä¸€æ˜¯å®šä¹‰jsæ–‡ä»¶ï¼ŒäºŒæ˜¯å®šä¹‰åŒ¿åè‡ªè°ƒç”¨å‡½æ•°

```js
function makeCounter() {
  var privateCounter = 0;
  function changeBy(val) {
    privateCounter += val;
  }
  return {
    increment: function() {
      changeBy(1);
    },
    decrement: function() {
      changeBy(-1);
    },
    value: function() {
      return privateCounter;
    }
  }
}

var Counter1 = makeCounter();
var Counter2 = makeCounter();
console.log(Counter1.value()); /* logs 0 */
Counter1.increment();
Counter1.increment();
console.log(Counter1.value()); /* logs 2 */
Counter1.decrement();
console.log(Counter1.value()); /* logs 1 */
console.log(Counter2.value()); /* logs 0 */
```

## ä¸‰ã€æ³¨æ„äº‹é¡¹

å¦‚æœä¸æ˜¯æŸäº›ç‰¹å®šä»»åŠ¡éœ€è¦ä½¿ç”¨é—­åŒ…ï¼Œåœ¨å…¶å®ƒå‡½æ•°ä¸­åˆ›å»ºå‡½æ•°æ˜¯ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºé—­åŒ…åœ¨å¤„ç†é€Ÿåº¦å’Œå†…å­˜æ¶ˆè€—æ–¹é¢å¯¹è„šæœ¬æ€§èƒ½å…·æœ‰è´Ÿé¢å½±å“ã€‚

ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æˆ–è€…ç±»æ—¶ï¼Œ==æ–¹æ³•é€šå¸¸åº”è¯¥å…³è”äºå¯¹è±¡çš„åŸå‹ï¼Œè€Œä¸æ˜¯å®šä¹‰åˆ°å¯¹è±¡çš„æ„é€ å™¨ä¸­ã€‚åŸå› åœ¨äºæ¯ä¸ªå¯¹è±¡çš„åˆ›å»ºï¼Œæ–¹æ³•éƒ½ä¼šè¢«é‡æ–°èµ‹å€¼==ã€‚

```js
function MyObject(name, message) {
  this.name = name.toString();
  this.message = message.toString();
  this.getName = function() {
    return this.name;
  };

  this.getMessage = function() {
    return this.message;
  };
}
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åˆ©ç”¨åˆ°é—­åŒ…çš„å¥½å¤„ï¼Œå› æ­¤å¯ä»¥é¿å…ä½¿ç”¨é—­åŒ…ã€‚ä¿®æ”¹æˆå¦‚ä¸‹ï¼š

```js
function MyObject(name, message) {
  this.name = name.toString();
  this.message = message.toString();
}
MyObject.prototype.getName = function() {
  return this.name;
};
MyObject.prototype.getMessage = function() {
  return this.message;
};
```

è¯æ³•ç¯å¢ƒä¸­ä¿å­˜ç€å±€éƒ¨å˜é‡nameã€‚

ç§æœ‰æ–¹æ³•ï¼šä¾‹å¦‚Javaä¸­ï¼Œç§æœ‰æ–¹æ³•åªèƒ½è¢«åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•è°ƒç”¨ã€‚

ç§æœ‰æ–¹æ³•ä¼˜ç‚¹ï¼šç§æœ‰æ–¹æ³•ä¸ä»…ä»…æœ‰åˆ©äºé™åˆ¶å¯¹ä»£ç çš„è®¿é—®ï¼šè¿˜æä¾›äº†ç®¡ç†å…¨å±€å‘½åç©ºé—´çš„å¼ºå¤§èƒ½åŠ›ï¼Œé¿å…éæ ¸å¿ƒçš„æ–¹æ³•å¼„ä¹±äº†ä»£ç çš„å…¬å…±æ¥å£éƒ¨åˆ†ã€‚

æ¯æ¬¡è°ƒç”¨æœ€å¤–é¢çš„å‡½æ•°éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é—­åŒ…ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ä¸€ä¸ªè¯æ³•ç¯å¢ƒã€‚æ¯ä¸ªé—­åŒ…éƒ½æ˜¯å¼•ç”¨è‡ªå·±è¯æ³•ä½œç”¨åŸŸå†…çš„å˜é‡ ã€‚