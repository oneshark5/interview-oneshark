<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    // â­â­â­å‘å¸ƒè®¢é˜…æ¨¡å¼â­â­â­
    class Star {
      constructor() {
        // å®šä¹‰æ•°ç»„åˆ—è¡¨ï¼Œå­˜æ”¾å›è°ƒå‡½æ•°
        this.followers = []
      }
      // è®¢é˜…
      follow(obj) {
        // å°†è®¢é˜…è€…åŠ å…¥æ•°ç»„
        this.followers.push(obj)
      }
      // å‘å¸ƒ
      publish() {
        this.followers.forEach(item => {
          // å›è°ƒå‡½æ•°
          item.fn(item.name);
        })
      }
    }

    const star = new Star()
    // ç²‰ä¸è®¢é˜…; å¹¶å®šä¹‰è‡ªå·±çš„å›è°ƒå‡½æ•°ï¼Œæ”¶åˆ°è®¢é˜…å†…å®¹ååº”æœ‰çš„æ“ä½œ
    star.follow({
      name: 'Bob',
      fn(name) {
        console.log(`${name}æ”¶åˆ°å†…å®¹`);
      }
    })
    star.follow({
      name: 'Jone',
      fn(name) {
        console.log(`${name}çœ‹åˆ°æ¶ˆæ¯ï¼Œå¹¶ç‚¹èµï¼`);
      },
    });
    star.follow({
      name: 'Tom',
      fn(name) {
        console.log(`${name}çœ‹åˆ°æ¶ˆæ¯ï¼Œå¹¶è¯„è®ºï¼`);
      },
    });
    // starå‘å¸ƒæ¶ˆæ¯
    star.publish();
    // Bobæ”¶åˆ°å†…å®¹
    // Joneçœ‹åˆ°æ¶ˆæ¯ï¼Œå¹¶ç‚¹èµï¼
    // Tomçœ‹åˆ°æ¶ˆæ¯ï¼Œå¹¶è¯„è®ºï¼

    const pubSub = {
      list: [],// æ•°ç»„ï¼Œå­˜æ”¾å›è°ƒå‡½æ•°
      // è®¢é˜…ï¼Œå­˜æ”¾çš„æ˜¯æ•´ä¸ªè®¢é˜…è€…å¯¹è±¡ï¼ˆé‡Œé¢æœ‰å›è°ƒå‡½æ•°ï¼Œä¾›æˆ‘ä»¬è°ƒç”¨ï¼‰
      subscribe(obj) {
        this.list.push(obj)
      },
      // å‘å¸ƒ--å¯ä»¥æ¥æ”¶ä¸€å®šçš„å†…å®¹ï¼Œä½œä¸ºå‘å¸ƒå†…å®¹
      publish(value) {
        this.list.forEach(item => {
          item.fun(item.name, value)
        })
      }
    }

    // æå‰è®¢é˜…
    pubSub.subscribe({
      name: 'è®¢é˜…è€…1',
      fun(name, value) {
        console.log(`${name}æ”¶åˆ°è®¢é˜…å†…å®¹ï¼š${value}`);
      }
    })
    pubSub.subscribe({
      name: 'è®¢é˜…è€…2',
      fun(name, value) {
        console.log(`${name}æ”¶åˆ°è®¢é˜…ï¼ï¼${value}`);
      }
    })

    // å‘å¸ƒ
    setTimeout(() => {
      pubSub.publish('ğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆ')
    }, 0)
    // è®¢é˜…è€…1æ”¶åˆ°è®¢é˜…å†…å®¹ï¼šğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆ
    // è®¢é˜…è€…2æ”¶åˆ°è®¢é˜…ï¼ï¼ğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆ



    // â­â­â­æµ‹è¯•å‘å¸ƒè®¢é˜…æ¨¡å¼â­â­â­
    //   class EventEmitter {
    //     // åˆå§‹åŒ–äº‹ä»¶å¯¹è±¡
    //     constructor() {
    //       this.events = {}
    //     }

    //     // äº‹ä»¶ç›‘å¬ï¼Œç›‘å¬çš„è¿‡ç¨‹å°±æ˜¯è®¢é˜…ï¼Œä¹Ÿå°±æ˜¯æŠŠè®¢é˜…è€…æ”¶é›†èµ·æ¥
    //     on(eventName, callback) {
    //       // å¦‚æœä¸å­˜åœ¨è¯¥äº‹ä»¶ï¼Œåˆ™è¿›è¡Œæ•°ç»„åˆå§‹åŒ–
    //       if (!this.events[eventName]) {
    //         this.events[eventName] = []
    //       }
    //       // å­˜åœ¨å¯¹åº”çš„æ•°ç»„ç»§ç»­è®¢é˜…æ”¶é›†ï¼Œåˆ™æŠŠäº‹ä»¶æ¨å…¥æ”¶é›†æ•°ç»„
    //       this.events[eventName].push(callback)
    //       // è¿”å›è‡ªèº« æ–¹ä¾¿é“¾å¼è°ƒç”¨
    //       return this
    //     }

    //     // äº‹ä»¶è§¦å‘ï¼Œè§¦å‘çš„è¿‡ç¨‹å°±æ˜¯å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯é€šçŸ¥è®¢é˜…è€…
    //     emit(eventName, ...args) {
    //       // ä¸å­˜åœ¨è¯¥äº‹ä»¶ï¼Œåˆ™ä¸è§¦å‘
    //       if (!this.events[eventName]) {
    //         return this
    //       }
    //       // å­˜åœ¨åˆ™å¯¹æ”¶é›†çš„è®¢é˜…è€…ä¸€ä¸€é€šçŸ¥(å‡½æ•°ä¸€ä¸€æ‰§è¡Œ)
    //       const fns = this.events[eventName]
    //       // æ‰§è¡Œçš„æ—¶å€™ç»‘å®šè‡ªèº«this
    //       fns.forEach(fn => fn.apply(this, args))
    //       // è¿”å›è‡ªèº« æ–¹ä¾¿é“¾å¼è°ƒç”¨
    //       return this
    //     }

    //     // è§£ç»‘äº‹ä»¶ï¼Œå–æ¶ˆè®¢é˜…ï¼Œå°†è®¢é˜…è€…ä»è®¢é˜…è€…æ•°ç»„ä¸­ç§»é™¤
    //     remove(eventName, callback) {
    //       if (!this.events[eventName]) {
    //         return this;
    //       }
    //       // æ²¡æœ‰æŒ‡å®šè§£ç»‘äº‹ä»¶? å°±æ˜¯æ²¡æœ‰æŒ‡å®šå¯¹åº”çš„è®¢é˜…è€…ï¼Œé‚£ä¹ˆç§»é™¤æ‰€æœ‰è®¢é˜…è€…
    //       if (!callback) {
    //         this.events[eventName] = null
    //         return this
    //       }
    //       // å¦åˆ™æ‰¾åˆ°è¯¥äº‹ä»¶, å°±æ˜¯å¯¹åº”çš„è®¢é˜…è€…ï¼Œå°†å…¶ç§»é™¤
    //       const index = this.events[eventName].indexOf(callback);
    //       this.events[eventName].splice(index, 1);
    //       return this;
    //     }

    //     // å•æ¬¡ç»‘å®šäº‹ä»¶,æ‰§è¡Œå®Œåè§£ç»‘
    //     once(eventName, callback) {
    //       const only = () => {
    //         callback.apply(this, arguments);
    //         this.remove(eventName, only);
    //       };
    //       this.on(eventName, only);
    //       return this;
    //     }
    //   }


    //   const emt = new EventEmitter()
    //   // è®¢é˜…è€…1
    //   const listener1 = function (...args) {
    //     console.log('æ„æ—çš„ç¬¬ä¸€ä¸ªè®¢é˜…è€…', ...args);
    //   }
    //   // è®¢é˜…è€…2
    //   const listener2 = function (...args) {
    //     console.log('æ„æ—çš„ç¬¬äºŒä¸ªè®¢é˜…è€…', ...args);
    //   }
    //   // æ”¶é›†è®¢é˜…è€…ï¼Œå°†æ‚å¿—å‘½åä¸º'yilin'
    //   emt.on('yilin', listener1)
    //   emt.on('yilin', listener2)

    //   // 500msåè®¢é˜…è€…1ä¸æƒ³è¦è¯¥æ‚å¿—äº†ï¼Œè¿›è¡Œå–æ¶ˆè®¢é˜…
    //   setTimeout(() => {
    //     emt.remove('yilin', listener1)
    //   }, 500)

    //   // 1ç§’åæ„æ—æ‚å¿—æ›´æ–°äº†ï¼Œè¿›è¡Œå‘å¸ƒï¼Œé€šçŸ¥è®¢é˜…è€…ï¼Œè¿™æ—¶ç”±äºè®¢é˜…è€…1å–æ¶ˆè®¢é˜…äº†ï¼Œæ‰€ä»¥è®¢é˜…è€…1å°±ä¸ä¼šæ‰§è¡Œäº†
    //   setTimeout(() => {
    //     emt.emit('yilin', 'hello world')
    //   }, 1000)

    // // æ‰“å°ç»“æœä¸ºï¼š1såæ‰“å° `æ„æ—çš„ç¬¬äºŒä¸ªè®¢é˜…è€… hello world`

    // æ”¹æˆå‡½æ•°å½¢å¼
    const EventEmitter = {
      // åˆå§‹åŒ–äº‹ä»¶å¯¹è±¡
      events: {},
      // äº‹ä»¶ç›‘å¬ï¼Œç›‘å¬çš„è¿‡ç¨‹å°±æ˜¯è®¢é˜…ï¼Œä¹Ÿå°±æ˜¯æŠŠè®¢é˜…è€…æ”¶é›†èµ·æ¥
      on(eventName, callback) {
        // å¦‚æœä¸å­˜åœ¨è¯¥äº‹ä»¶ï¼Œåˆ™è¿›è¡Œæ•°ç»„åˆå§‹åŒ–
        if (!this.events[eventName]) {
          this.events[eventName] = []
        }
        // å­˜åœ¨å¯¹åº”çš„æ•°ç»„ç»§ç»­è®¢é˜…æ”¶é›†ï¼Œåˆ™æŠŠäº‹ä»¶æ¨å…¥æ”¶é›†æ•°ç»„
        this.events[eventName].push(callback)
        // è¿”å›è‡ªèº« æ–¹ä¾¿é“¾å¼è°ƒç”¨
        return this
      },

      // äº‹ä»¶è§¦å‘ï¼Œè§¦å‘çš„è¿‡ç¨‹å°±æ˜¯å‘å¸ƒï¼Œä¹Ÿå°±æ˜¯é€šçŸ¥è®¢é˜…è€…
      emit(eventName, ...args) {
        // ä¸å­˜åœ¨è¯¥äº‹ä»¶ï¼Œåˆ™ä¸è§¦å‘
        if (!this.events[eventName]) {
          return this
        }
        // å­˜åœ¨åˆ™å¯¹æ”¶é›†çš„è®¢é˜…è€…ä¸€ä¸€é€šçŸ¥(å‡½æ•°ä¸€ä¸€æ‰§è¡Œ)
        const fns = this.events[eventName]
        // æ‰§è¡Œçš„æ—¶å€™ç»‘å®šè‡ªèº«this
        fns.forEach(fn => fn.apply(this, args))
        // è¿”å›è‡ªèº« æ–¹ä¾¿é“¾å¼è°ƒç”¨
        return this
      },

      // è§£ç»‘äº‹ä»¶ï¼Œå–æ¶ˆè®¢é˜…ï¼Œå°†è®¢é˜…è€…ä»è®¢é˜…è€…æ•°ç»„ä¸­ç§»é™¤
      remove(eventName, callback) {
        if (!this.events[eventName]) {
          return this;
        }
        // æ²¡æœ‰æŒ‡å®šè§£ç»‘äº‹ä»¶? å°±æ˜¯æ²¡æœ‰æŒ‡å®šå¯¹åº”çš„è®¢é˜…è€…ï¼Œé‚£ä¹ˆç§»é™¤æ‰€æœ‰è®¢é˜…è€…
        if (!callback) {
          this.events[eventName] = null
          return this
        }
        // å¦åˆ™æ‰¾åˆ°è¯¥äº‹ä»¶, å°±æ˜¯å¯¹åº”çš„è®¢é˜…è€…ï¼Œå°†å…¶ç§»é™¤
        const index = this.events[eventName].indexOf(callback);
        this.events[eventName].splice(index, 1);
        return this;
      }
    }

    // è®¢é˜…è€…1
    const listener1 = function (...args) {
      console.log('æ„æ—çš„ç¬¬ä¸€ä¸ªè®¢é˜…è€…', ...args);
    }
    // è®¢é˜…è€…2
    const listener2 = function (...args) {
      console.log('æ„æ—çš„ç¬¬äºŒä¸ªè®¢é˜…è€…', ...args);
    }
    // æ”¶é›†è®¢é˜…è€…ï¼Œå°†æ‚å¿—å‘½åä¸º'yilin'
    EventEmitter.on('yilin', listener1)
    EventEmitter.on('yilin', listener2)

    // 500msåè®¢é˜…è€…1ä¸æƒ³è¦è¯¥æ‚å¿—äº†ï¼Œè¿›è¡Œå–æ¶ˆè®¢é˜…
    setTimeout(() => {
      EventEmitter.remove('yilin', listener1)
    }, 500)

    // 1ç§’åæ„æ—æ‚å¿—æ›´æ–°äº†ï¼Œè¿›è¡Œå‘å¸ƒï¼Œé€šçŸ¥è®¢é˜…è€…ï¼Œè¿™æ—¶ç”±äºè®¢é˜…è€…1å–æ¶ˆè®¢é˜…äº†ï¼Œæ‰€ä»¥è®¢é˜…è€…1å°±ä¸ä¼šæ‰§è¡Œäº†
    setTimeout(() => {
      EventEmitter.emit('yilin', 'hello world')
    }, 1000)

    // æ‰“å°ç»“æœä¸ºï¼š1såæ‰“å° `æ„æ—çš„ç¬¬äºŒä¸ªè®¢é˜…è€… hello world`
  </script>
</body>

</html>