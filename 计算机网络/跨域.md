## ğŸ¦ˆè·¨åŸŸ

### é¢è¯•é¢˜

1. è®²ä¸€ä¸‹è·¨åŸŸï¼Ÿä¸ºä»€ä¹ˆæœåŠ¡ç«¯æ²¡æœ‰åŒæºé™åˆ¶ï¼Ÿ

2. è·¨åŸŸäº†è§£å—

3. æ€ä¹ˆè§£å†³è·¨åŸŸ

4. æµè§ˆå™¨å­˜å‚¨ï¼Œèƒ½å¦è·¨åŸŸï¼Ÿ

   localstorageä½¿ç”¨æ—¶çš„æ³¨æ„ç‚¹ï¼Œèƒ½å­˜å‚¨å“ªäº›æ•°æ®ç±»å‹ï¼Œcookieå¦‚ä½•è®¾ç½®ï¼Ÿ

   è·¨åŸŸçš„æ–¹å¼ï¼Œä¼˜ç¼ºç‚¹ï¼Ÿ

   CORSçš„ç»†èŠ‚ï¼Ÿ

5. ajaxçš„æ­¥éª¤

6. ajaxç¼ºç‚¹

7. scriptæ ‡ç­¾çš„æ–¹æ³•å«ä»€ä¹ˆåå­—jsonp æœ‰ä»€ä¹ˆç¼ºç‚¹

8. åå°è·å–åˆ°çš„æ•°æ®æ€ä¹ˆæ’åˆ°é¡µé¢ä¸Š

9. ajaxä½¿ç”¨jsçš„ä»€ä¹ˆæŠ€æœ¯

10. è¯´ä¸€ä¸‹è·¨åŸŸè¯·æ±‚å¦‚ä½•æºå¸¦cookie

### 1. åŒæºç­–ç•¥

#### ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ

åŒæºç­–ç•¥(Same-Origin Policy)æœ€æ—©ç”± Netscape å…¬å¸æå‡ºï¼Œæ˜¯æµè§ˆå™¨çš„ä¸€ç§==å®‰å…¨ç­–ç•¥==ã€‚åŒæºï¼š åè®®ã€åŸŸåã€ç«¯å£å· å¿…é¡»å®Œå…¨ç›¸åŒã€‚

==è¿èƒŒåŒæºç­–ç•¥å°±æ˜¯è·¨åŸŸ==ã€‚ğŸ¦ˆä¸åŒæºä¹‹é—´çš„è¯·æ±‚å°±æ˜¯è·¨åŸŸæ“ä½œï¼Œåè®®ã€åŸŸåã€ç«¯å£å·æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯ä¸åŒæºã€‚

#### ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸï¼Ÿ

1. å•å°æœåŠ¡å™¨æœåŠ¡æ˜¯æœ‰ä¸Šçº¿çš„ï¼Œæ€§èƒ½æ˜¯æœ‰ç“¶é¢ˆçš„ï¼Œæ‰€ä»¥éœ€è¦å¢åŠ æœåŠ¡å™¨å»æä¾›æœåŠ¡ï¼Œå°±å½¢æˆè·¨åŸŸã€‚

#### ä¸ºä»€ä¹ˆè¦è·¨åŸŸé™åˆ¶ï¼ˆåŒæºç­–ç•¥ï¼‰ï¼Ÿ

1. å¯ä»¥ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ï¼Œå‡å°‘XSSã€CSRFç­‰æ”»å‡»ã€‚

#### åŒæºç­–ç•¥é™åˆ¶çš„å†…å®¹

1. æ— æ³•è¯»å–éåŒæºç½‘é¡µçš„ Cookieã€LocalStorage å’Œ IndexedDB
2. æ— æ³•æ¥è§¦éåŒæºç½‘é¡µçš„ DOM
3. å‘éåŒæºåœ°å€å‘é€ AJAX è¯·æ±‚æµè§ˆå™¨ä¼šæ‹’ç»å“åº”
   axiosé»˜è®¤éµå¾ªåŒæºç­–ç•¥ï¼ˆä¸æ»¡è¶³åŒæºç­–ç•¥æ˜¯æ— æ³•å‘é€Ajaxè¯·æ±‚ï¼‰

#### åŒæºç­–ç•¥ä¸¾ä¾‹

- å¦‚ï¼šç½‘é¡µè¯·æ±‚æœåŠ¡ç«¯æ•°æ®æ—¶ï¼ŒåŒæºç­–ç•¥å³å¿…é¡»åè®®ã€åŸŸåã€ç«¯å£å· å¿…é¡»å®Œå…¨ç›¸åŒã€‚
  å¦‚ä¸‹å›¾è®¿é—®ç½‘é¡µï¼Œæˆ‘ä»¬è¯·æ±‚çš„ç›®æ ‡èµ„æºå’Œç½‘é¡µèµ„æºéƒ½æ˜¯æ¥è‡ªåŒä¸€å°æœåŠ¡å™¨çš„åŒä¸€ä¸ªæœåŠ¡ï¼Œæ‰€ä»¥æ˜¯åŒæºã€‚ä½†æ˜¯ä½ åœ¨a.comç½‘é¡µå‘b.comå‘é€äº†ä¸€ä¸ªè¯·æ±‚å°±æ˜¯è·¨åŸŸçš„ã€‚
  ![1651059590409](è·¨åŸŸ.assets/1651059590409.png)
- ä¸¾ä¾‹ï¼šåŒæºç­–ç•¥ï¼Œé¡µé¢å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ä»åŒä¸€ä¸ªæœåŠ¡å™¨è·å–çš„ï¼Œä¸å­˜åœ¨è·¨åŸŸæƒ…å†µã€‚

![1650895644517](è·¨åŸŸ.assets/1650895644517.png)

- ä»£ç æ¼”ç¤º

  **é¦–å…ˆåˆ›å»ºæœåŠ¡ç«¯ä»£ç **

  ```js
  // æœåŠ¡ç«¯ä»£ç 
  // 1. å¼•å…¥express
  // const {request, response} = require('express')
  const express = require('express')
  // 2. åˆ›å»ºå¯¹è±¡
  const app = express()
  // 3. åˆ›å»ºè·¯ç”±
  app.get('/home', (request, response)=>{
    // è¿”å›å“åº”---åŠ ç»å¯¹è·¯å¾„æ˜¯ä»€ä¹ˆæ„æ€
    response.sendFile(__dirname + '/index.html')
  })
  // å“åº”æ•°æ®
  app.get('/data', (request, response)=>{
    // è¿”å›å“åº”æ•°æ®
    response.send('æ•°æ®æ•°æ®æ•°æ®æ•°æ®æ•°æ®')
  })
  // 4. ç›‘å¬ç«¯å£
  app.listen(9000, ()=>{
    console.log("æœåŠ¡å·²ç»å¯åŠ¨, 9000 ç«¯å£ç›‘å¬ä¸­....");
  })
  ```

  åœ¨127.0.0.1ï¼š9000åœ°å€è¯·æ±‚é¡µé¢ã€‚

  ![1650943452064](è·¨åŸŸ.assets/1650943452064.png)

  **åˆ›å»ºå‰ç«¯é¡µé¢ä»£ç **

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- å¼•å…¥axiosï¼›crossorigin="anonymous"è§£å†³è·¨åŸŸé—®é¢˜ -->
    <script crossorigin="anonymous" src="https://cdn.bootcdn.net/ajax/libs/axios/0.26.1/axios.js"></script>
  </head>
  <body>
    <h1>åŒæºç­–ç•¥ä»£ç å±•ç¤º</h1>
    <button>éœ€æ±‚ï¼šç‚¹å‡»æŒ‰é’®è·å–æ•°æ®</button>
    <script>
      // è·å–å¯¹è±¡
      const btn = document.querySelector('button')
      // ç»‘å®šäº‹ä»¶
      btn.onclick = ()=>{
        // åŸç”ŸAJAXæ–¹æ³•
        /* // 1.åˆ›å»ºxhrå¯¹è±¡
        const xhr = new XMLHttpRequest()
        // 2.åˆå§‹åŒ–
        xhr.open('GET','/data')
        // 3.å‘é€è¯·æ±‚
        xhr.send()
        // 4.ç»‘å®šäº‹ä»¶
        xhr.onreadystatechange = ()=>{
          if(xhr.readyState === 4){
            if(xhr.status>=200 && xhr.status<300){
              alert(xhr.response);
            }
          }
        } */
  
        // axiosæ–¹æ³•---å‰ææ˜¯éœ€è¦å¼•å…¥axiosåŒ…
        axios({
          // axiosé€šç”¨æ–¹æ³•: è¯·æ±‚æ–¹æ³• url è¯·æ±‚å¤´Headers è¯·æ±‚ä½“data  å…¶ä»–é…ç½®params
          method:'GET',
          url:'/data',
  
        }).then(response=>{
          console.log(response);
          console.log('axiosæ–¹æ³•è¯·æ±‚çš„æ•°æ®ä¸º=' + response.data);
        })
      }
    </script>
  </body>
  </html>
  ```

  ![1650944189678](è·¨åŸŸ.assets/1650944189678.png)

### 2. å¦‚ä½•è§£å†³è·¨åŸŸ

#### 2.1 JSONP

åœ¨ç½‘é¡µæœ‰ä¸€äº›æ ‡ç­¾å¤©ç”Ÿ==å…·æœ‰è·¨åŸŸèƒ½åŠ›==ï¼Œæ¯”å¦‚ï¼šimg link iframe scriptã€‚

JSONPæ˜¯éå®˜æ–¹è§£å†³æ–¹æ¡ˆï¼Œä»…æ”¯æŒgetè¯·æ±‚ï¼Œå€ŸåŠ©scriptæ ‡ç­¾**æ²¡æœ‰è·¨åŸŸé™åˆ¶**å®ç°è·¨åŸŸã€‚

- **jsonpå®ç°è·¨åŸŸçš„åŸç†**
  æœåŠ¡ç«¯è¿”å›çš„ç»“æœçš„å½¢å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè€Œå‡½æ•°handleçš„å‚æ•°æ˜¯æƒ³ç»™å®¢æˆ·ç«¯è¿”å›çš„ç»“æœæ•°æ®ã€‚---å³è¿”å›å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”æŠŠå‚æ•°æ”¾åˆ°é‡Œé¢ï¼Œå¹¶ä¸”**å‡½æ•°è¦åœ¨å‰ç«¯æå‰å£°æ˜**ã€‚

- **JSONPä¼˜ç¼ºç‚¹**

  JSONPä¼˜ç‚¹æ˜¯ç®€å•å…¼å®¹æ€§å¥½ï¼Œå¯ç”¨äºè§£å†³ä¸»æµæµè§ˆå™¨çš„è·¨åŸŸæ•°æ®è®¿é—®çš„é—®é¢˜ã€‚**ç¼ºç‚¹æ˜¯ä»…æ”¯æŒgetæ–¹æ³•å…·æœ‰å±€é™æ€§,ä¸å®‰å…¨å¯èƒ½ä¼šé­å—XSSæ”»å‡»ã€‚**---ä¸çŸ¥é“æ€ä¹ˆè¢«æ”»å‡»çš„å°±åˆ«è¯´ã€‚

- **JSONPä½¿ç”¨æ­¥éª¤**

```js
// 1.åˆ›å»ºscriptæ ‡ç­¾
const script = document.createElement('script')
// 2.ç»™scriptæ ‡ç­¾ç»‘å®šsrcå±æ€§
script.src = 'http://127.0.0.1:5000/check-username'
// 3.å°†scriptæ ‡ç­¾æ·»åŠ åˆ°æ–‡æ¡£
document.body.appendChild(script)
```

- **å¼•å…¥ï¼šscriptæ ‡ç­¾å…·æœ‰è·¨åŸŸç‰¹æ€§çš„ä¾‹å­**

ä¸‹é¢çš„axiosæ˜¯ä¸€ä¸ªè·¨åŸŸè¯·æ±‚ï¼Œåè®®ã€åŸŸåã€ç«¯å£éƒ½ä¸ä¸€æ ·ã€‚---è¿™ä¸ªä¾‹å­å¯ä»¥è¯´æ˜scriptæ ‡ç­¾æœ¬èº«å…·æœ‰è·¨åŸŸç‰¹æ€§ã€‚

```html
<script crossorigin="anonymous" src="https://cdn.bootcdn.net/ajax/libs/axios/0.26.1/axios.js"></script>
```

> srcå±æ€§æŒ‡å‘ä¸€ä¸ªå¤–éƒ¨ JavaScript æ–‡ä»¶ï¼Œsrc å±æ€§è§„å®šå¤–éƒ¨è„šæœ¬æ–‡ä»¶çš„ URLã€‚

é‡‡ç”¨httpè¯·æ±‚å¼•å…¥æ–‡ä»¶ï¼Œæœ‰è·¨åŸŸä»ç„¶å¯ä»¥å®ç°---è¯´æ˜scriptæ ‡ç­¾å…·æœ‰è·¨åŸŸç‰¹æ€§ã€‚

```html
<script src="http://127.0.0.1:5500/DemoMe/7-%E8%B7%A8%E5%9F%9F/%E5%A4%8D%E4%B9%A0/2-JSONP/js/app.js"></script>
```

- **å¼•å…¥jsonpè§£å†³è·¨åŸŸé—®é¢˜**

  åŸç†ï¼šå¼•å…¥jsæ–‡ä»¶ï¼Œåœ¨é¡µé¢ä¸­è§£æ

å°ç»“ï¼š

1. ä»¥ä¸Šä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªjså¤–éƒ¨æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å®šä¹‰äº†æ•°æ®å’Œå‡½æ•°è°ƒç”¨ï¼Œåœ¨å‰ç«¯é¡µé¢å¼•å…¥jsæ–‡ä»¶ï¼Œæµè§ˆå™¨å¯¹é½è¿›è¡Œè§£æå¹¶æ‰§è¡Œã€‚
2. ä½¿ç”¨scriptå¼•å…¥å¤–éƒ¨jsæ–‡ä»¶ï¼Œè¯¥scriptæ ‡ç­¾é‡‡ç”¨httpè¯·æ±‚ï¼Œä¼šæœ‰è·¨åŸŸç°è±¡ï¼Œä½†ä»èƒ½æ­£å¸¸æ‰§è¡Œã€‚

å®šä¹‰å¤–éƒ¨jsæ–‡ä»¶

```js
// jsè¿”å›ç»“æœæ˜¯ä¸€ä¸ªæ•°æ®+å‡½æ•°çš„è°ƒç”¨
const data = {
  name:'æµ‹è¯•scriptæ ‡ç­¾çš„è·¨åŸŸç‰¹æ€§'
}
handle(data)
```

å®šä¹‰htmlæ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #result {
      width: 300px;
      height: 100px;
      border: solid 2px #78a;
    }
  </style>
</head>
<body>
  <div id="result"></div>
  <script>
    function handle(data) {
      const result = document.getElementById('result')
      result.innerHTML = data.name
    }
  </script>
  <!-- å¼•å…¥å¤–éƒ¨jsæ–‡ä»¶ -->
  <!-- <script src="./js/app.js"></script> -->
  <!-- é‡‡ç”¨httpè¯·æ±‚å¼•å…¥jsæ–‡ä»¶ï¼ˆæ¨¡ä»¿è·¨åŸŸï¼‰ -->
  <script src="http://127.0.0.1:5500/DemoMe/7-%E8%B7%A8%E5%9F%9F/%E5%A4%8D%E4%B9%A0/2-JSONP/js/app.js"></script>
</body>
</html>
```

æŸ¥çœ‹è¿”å›ç»“æœï¼Œè¿”å›æ•°æ®+ä¸€ä¸ªå‡½æ•°è°ƒç”¨

![1650975427091](è·¨åŸŸ.assets/1650975427091.png)

- **ä½¿ç”¨scriptæ ‡ç­¾è¯·æ±‚expressæœåŠ¡å™¨æ•°æ®**ï¼ˆè·¨åŸŸï¼‰

  åŸç†ï¼šé‡‡ç”¨scriptæ ‡ç­¾å¼•å…¥åœ°å€ï¼Œåªæœ‰æœåŠ¡ç«¯è¿”å›jsä»£ç æ—¶ï¼Œæ‰èƒ½æ­£ç¡®è§£æã€‚

å‰ç«¯é¡µé¢ä»£ç ï¼ˆåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šæ›´æ”¹scriptæ ‡ç­¾ï¼‰

```html
<body>
  <div id="result"></div>
  <script>
    //å‰ç«¯æå‰å®šä¹‰å¥½å›è°ƒå‡½æ•°
    function handle(data) {
      const result = document.getElementById('result')
      result.innerHTML = data.name
    }
  </script>
  <!-- è¯·æ±‚jsonpæ•°æ® -->
  <script src="http://127.0.0.1:5000/jsonp-server"></script>
</body>
```

æœåŠ¡ç«¯expressä»£ç 

```js
// æœåŠ¡ç«¯ä»£ç çš„å‡†å¤‡
//1. å¼•å…¥express
const { request, response } = require('express');
const express = require('express');
//2. åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();
//3. åˆ›å»ºè·¯ç”±è§„åˆ™
// jsonpæœåŠ¡
app.all('/jsonp-server', (request, response)=>{
  response.send('ä¸èƒ½è¯·æ±‚åˆ°æ•°æ®')
})
//4. ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡
app.listen(5000, ()=>{
    console.log("æœåŠ¡å·²ç»å¯åŠ¨, 5000 ç«¯å£ç›‘å¬ä¸­....");
});
```

è¿”å›ç»“æœæ˜¯ä¸€ä¸²è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œscriptæ ‡ç­¾æ— æ³•è§£æã€‚ï¼ˆè¿”å›æ ‡å‡†çš„jsä»£ç ï¼‰

![1650976686775](è·¨åŸŸ.assets/1650976686775.png)

éœ€è¦è¿”å›æ ‡å‡†çš„jsä»£ç æ‰èƒ½æ­£ç¡®è§£æ

```js
app.all('/jsonp-server', (request, response)=>{
  // è¿”å›jsä»£ç 
  response.send("console.log('ä¸€æ®µæ‰“å°è¾“å‡ºçš„jsä»£ç ')")
})
```

![1650977020635](è·¨åŸŸ.assets/1650977020635.png)

æ‰€ä»¥scriptæ ‡ç­¾å‘é€è¯·æ±‚åï¼Œè¿”å›çš„æ˜¯éœ€è¦æ˜¯==ä¸€æ®µå‡½æ•°è°ƒç”¨çš„å†…å®¹ï¼ˆä¸€æ®µjsä»£ç ï¼‰==ã€‚è¿™æ ·æ‰èƒ½æ­£ç¡®è¾“å‡ºã€‚

- é‡‡ç”¨å›è°ƒå‡½æ•°å½¢å¼ã€‚å°†è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚

==jsonpå®ç°è·¨åŸŸçš„åŸç†==ï¼šè¿”å›çš„ç»“æœçš„å½¢å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè€Œå‡½æ•°handleçš„å‚æ•°æ˜¯æƒ³ç»™å®¢æˆ·ç«¯è¿”å›çš„ç»“æœæ•°æ®ã€‚---å³è¿”å›å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”æŠŠå‚æ•°æ”¾åˆ°é‡Œé¢ï¼Œå¹¶ä¸”**å‡½æ•°è¦åœ¨å‰ç«¯æå‰å£°æ˜**ã€‚

```js
app.all('/jsonp-server', (request, response) => {
  // jså¯¹è±¡---æƒ³è¦è¿”å›çš„æ•°æ®
  const data = {
    name:'è¿”å›å‡½æ•°è°ƒç”¨ï¼Œå‚æ•°å°±æ˜¯æƒ³è¦è¿”å›çš„æ•°æ®'
  }
  // å°†æ•°æ®è½¬åŒ–ä¸ºå­—ç¬¦ä¸²
  let str = JSON.stringify(data);
  //è¿”å›ç»“æœ(endä¸ä¼šåŠ ç‰¹æ®Šå“åº”å¤´)
  response.end(`handle(${str})`);
  /* 
  è¿”å›çš„ç»“æœçš„å½¢å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨,è€Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°å°±è¯´æˆ‘ä»¬æƒ³ç»™å®¢æˆ·ç«¯è¿”å›çš„ç»“æœæ•°æ®
  handleæ˜¯å‰ç«¯å·²ç»å®šä¹‰å¥½çš„å‡½æ•°,è¿™é‡Œç›´æ¥è°ƒç”¨å¹¶ä¼ å®å‚
  */
})
```

![1650978632988](è·¨åŸŸ.assets/1650978632988.png)

- **jsonpå®ç°è·¨åŸŸçš„å®Œæ•´ä»£ç **

  é‡ç‚¹ï¼šjsonpçš„ä½¿ç”¨æµç¨‹

  ```js
  // 1.åˆ›å»ºscriptæ ‡ç­¾
  const script = document.createElement('script')
  // 2.ä¸ºscriptæ ‡ç­¾æ·»åŠ srcå±æ€§
  script.src = 'http://127.0.0.1:5000/jsonp-server'
  // 3.å°†scriptæ·»åŠ åˆ°æ–‡æ¡£ä¸­
  document.body.appendChild(script)
  ```

  **å‰ç«¯ä»£ç **

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
      #result {
        width: 300px;
        height: 100px;
        border: solid 2px #78a;
      }
    </style>
  </head>
  
  <body>
    <div id="result"></div>
    <script>
      function handle(data) {
        const result = document.getElementById('result')
        result.innerHTML = data.name
      }
    </script>
    <!-- ä½¿ç”¨jsonpçš„æµç¨‹ -->
    <script>
    // 1.åˆ›å»ºscriptæ ‡ç­¾
    const script = document.createElement('script')
    // 2.ä¸ºscriptæ ‡ç­¾æ·»åŠ srcå±æ€§
    script.src = 'http://127.0.0.1:5000/jsonp-server'
    // 3.å°†scriptæ·»åŠ åˆ°æ–‡æ¡£ä¸­
    document.body.appendChild(script)
    </script>
  </body>
  </html>
  ```

  **æœåŠ¡ç«¯ä»£ç **

  ```js
  // æœåŠ¡ç«¯ä»£ç çš„å‡†å¤‡
  //1. å¼•å…¥express
  const { request, response } = require('express');
  const express = require('express');
  //2. åˆ›å»ºåº”ç”¨å¯¹è±¡
  const app = express();
  //3. åˆ›å»ºè·¯ç”±è§„åˆ™
  // jsonpæœåŠ¡
  app.all('/jsonp-server', (request, response) => {
    // jså¯¹è±¡---æƒ³è¦è¿”å›çš„æ•°æ®
    const data = {
      name:'è¿”å›å‡½æ•°è°ƒç”¨ï¼Œå‚æ•°å°±æ˜¯æƒ³è¦è¿”å›çš„æ•°æ®'
    }
    // å°†æ•°æ®è½¬åŒ–ä¸ºå­—ç¬¦ä¸²
    let str = JSON.stringify(data);
    //è¿”å›ç»“æœ(endä¸ä¼šåŠ ç‰¹æ®Šå“åº”å¤´)
    response.end(`handle(${str})`);
    /* 
    è¿”å›çš„ç»“æœçš„å½¢å¼æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨,è€Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°å°±è¯´æˆ‘ä»¬æƒ³ç»™å®¢æˆ·ç«¯è¿”å›çš„ç»“æœæ•°æ®
    handleæ˜¯å‰ç«¯å·²ç»å®šä¹‰å¥½çš„å‡½æ•°,è¿™é‡Œç›´æ¥è°ƒç”¨å¹¶ä¼ å®å‚
    */
  })
  //4. ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡
  app.listen(5000, () => {
    console.log("æœåŠ¡å·²ç»å¯åŠ¨, 5000 ç«¯å£ç›‘å¬ä¸­....");
  });
  ```

  

å°ç»“ï¼šå€ŸåŠ©scriptæ ‡ç­¾å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªhandleå‡½æ•°çš„è°ƒç”¨ï¼Œæµè§ˆå™¨è§£æå™¨æ£€æµ‹èƒ½å¤Ÿæ‰§è¡Œï¼Œç›´æ¥æ‰§è¡Œå¹¶å¤„ç†æ•°æ®ã€‚

- **JSONPåŸç”Ÿå®è·µ**

  éœ€æ±‚ï¼šè¾“å…¥ç”¨æˆ·åå­˜åœ¨åˆ™è¾¹æ¡†å˜ä¸ºçº¢è‰²å¹¶ä¸”è¾“å‡ºä¸€æ®µæç¤ºæ–‡å­—

  **å‰ç«¯ä»£ç **

  ```html
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>
  <body>
    <!-- éœ€æ±‚ï¼šè¾“å…¥ç”¨æˆ·åå­˜åœ¨åˆ™è¾¹æ¡†å˜ä¸ºçº¢è‰²å¹¶ä¸”è¾“å‡ºä¸€æ®µæç¤ºæ–‡å­— -->
    ç”¨æˆ·åï¼š<input type="text"  id="username">
    <p></p>
    <script>
      // è·å–å…ƒç´ 
      const input = document.querySelector('input')
      const p = document.querySelector('p')
  
      // å®šä¹‰å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å¿…é¡»æå‰å®šä¹‰åœ¨å‰ç«¯é¡µé¢é‡Œ
      const handle = function(data){
        // å¤„ç†å‡½æ•°è¦è®¾ç½®è¾¹æ¡†å’Œæ·»åŠ æ–‡å­—
        input.style.border = 'solid 1px #f00'
        p.innerHTML = data.msg
      }
      // ç»‘å®šäº‹ä»¶
      input.onblur = function(){
        // è·å–ç”¨æˆ·çš„è¾“å…¥å€¼---ï¼Ÿè¿™ä¸€æ­¥æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ
        let username = this.value
        // åˆ©ç”¨scripté‡‡ç”¨jsonpæ–¹æ³•å‘é€è¯·æ±‚
        // 1.åˆ›å»ºscriptæ ‡ç­¾
        const script = document.createElement('script')
        // 2.ç»™scriptæ ‡ç­¾ç»‘å®šsrcå±æ€§
        script.src = 'http://127.0.0.1:5000/check-username'
        // 3.å°†scriptæ ‡ç­¾æ·»åŠ åˆ°æ–‡æ¡£
        document.body.appendChild(script)
      }
  
    </script>
  </body>
  </html>
  ```

  **æœåŠ¡ç«¯ä»£ç **

  ```js
  // æœåŠ¡ç«¯ä»£ç çš„å‡†å¤‡
  //1. å¼•å…¥express
  const { request, response } = require('express');
  const express = require('express');
  //2. åˆ›å»ºåº”ç”¨å¯¹è±¡
  const app = express();
  //3. åˆ›å»ºè·¯ç”±è§„åˆ™
  // jsonpå®è·µ
  app.all('/check-username', (request, response)=>{
    // å®šä¹‰è¦è¿”å›çš„æ•°æ®
    const data = {
      exist:1,
      msg:'ç”¨æˆ·åå·²å­˜åœ¨'
    }
    // å°†æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²
    const str = JSON.stringify(data)
    // è¿”å›ç»“æœ
    response.end(`handle(${str})`)
  })
  //4. ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡
  app.listen(5000, () => {
    console.log("æœåŠ¡å·²ç»å¯åŠ¨, 5000 ç«¯å£ç›‘å¬ä¸­....");
  });
  ```

  ![1650982536245](è·¨åŸŸ.assets/1650982536245.png)

  ![1650982567683](è·¨åŸŸ.assets/1650982567683.png)

ğŸ¦ˆæ€»ç»“ï¼š

1. JSONPæ–¹æ³•è§£å†³è·¨åŸŸæ˜¯å€ŸåŠ©scriptæ ‡ç­¾å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚
2. æœåŠ¡ç«¯è¿”å›æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°çš„è°ƒç”¨ï¼Œ
3. è¿”å›ç»“æœæ˜¯ä¸€ä¸ªhandleå‡½æ•°çš„è°ƒç”¨ï¼Œæµè§ˆå™¨è§£æå™¨æ£€æµ‹èƒ½å¤Ÿæ‰§è¡Œï¼Œç›´æ¥æ‰§è¡Œå¹¶å¤„ç†æ•°æ®ã€‚

#### 2.2 CORS

å®˜æ–¹è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼›

å‰é¢çš„AJAXè¯·æ±‚ï¼Œaxios-ajaxè¯·æ±‚éƒ½æ˜¯é‡‡ç”¨çš„corsè·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œè®¾ç½®å“åº”å¤´ã€‚

è®¾ç½®è·¨åŸŸæ–¹æ³•ï¼šå®¢æˆ·ç«¯ä¸åšä»»ä½•å¤„ç†ï¼Œåœ¨æœåŠ¡ç«¯è®¾ç½®å“åº”å¤´ï¼Œå…è®¸è·¨åŸŸæ—¢å¯ä»¥ã€‚

```js
response.setHeader('Access-Control-Allow-Origin', '*')
```

å®é™…æ¡ˆä¾‹ï¼š

éœ€æ±‚ï¼šç‚¹å‡»æŒ‰é’®ï¼Œæ‰“å°è¾“å‡ºä¸€ä¸‹å°±è¡Œ

**å‰ç«¯ä»£ç **

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <button>å‘é€è¯·æ±‚</button>
  <script>
    // è·å–å…ƒç´ 
    const btn = document.querySelector('button')
    // ç»‘å®šäº‹ä»¶---å¤„ç†è¯·æ±‚çš„æ•°æ®
    btn.onclick = function(){
      // å‘é€AJAXè¯·æ±‚çš„å››æ­¥
      // 1.åˆ›å»ºxhrå¯¹è±¡
      const xhr = new XMLHttpRequest()
      // 2.åˆå§‹åŒ–ï¼ˆè®¾ç½®è¯·æ±‚æ–¹æ³•å’Œurlï¼‰
      xhr.open('GET', 'http://127.0.0.1:5000/cors-server')
      // 3.å‘é€è¯·æ±‚
      xhr.send()
      // 4.ç»‘å®šäº‹ä»¶,å¤„ç†å“åº”ç»“æœï¼ˆè¿”å›çš„æ•°æ®æ€ä¹ˆå¤„ç†ï¼‰
      xhr.onreadystatechange = function(){
        if(xhr.readyState === 4){
          if(xhr.status>=200 && xhr.status<300){
            // å¤„ç†æˆåŠŸæ•°æ®
            console.log(xhr.response);
          }
        }
      }
    }
  </script>
</body>
</html>
```

**æœåŠ¡ç«¯ä»£ç **

```js
// æœåŠ¡ç«¯ä»£ç çš„å‡†å¤‡
//1. å¼•å…¥express
const { request, response } = require('express');
const express = require('express');
//2. åˆ›å»ºåº”ç”¨å¯¹è±¡
const app = express();
//3. åˆ›å»ºè·¯ç”±è§„åˆ™
// corsè·¨åŸŸ
app.all('/cors-server', (request, response)=>{
  // è®¾ç½®å…è®¸è·¨åŸŸ---åé¢å¡«å†™å…è®¸è·¨åŸŸçš„urlï¼Œ*å·è¡¨ç¤ºå…è®¸æ‰€æœ‰url
  // response.setHeader('Access-Control-Allow-Origin', 'http://127.0.0.1:5000')
  // ä¸€èˆ¬è®¾ç½®ä¸‰ä¸ªï¼Œå…è®¸è·¨åŸŸã€å¯ä»¥è‡ªå®šä¹‰å¤´ä¿¡æ¯ã€éšæ„å®šä¹‰è¯·æ±‚æ–¹æ³•
  response.setHeader('Access-Control-Allow-Origin', '*')
  response.setHeader('Access-Control-Allow-Header', '*')
  response.setHeader('Access-Control-Allow-Method', '*')
  response.send('corsè·¨åŸŸ')
})
//4. ç›‘å¬ç«¯å£å¯åŠ¨æœåŠ¡
app.listen(5000, () => {
  console.log("æœåŠ¡å·²ç»å¯åŠ¨, 5000 ç«¯å£ç›‘å¬ä¸­....");
});
```

ä¸è®¾ç½®å“åº”å¤´ï¼ˆå­˜åœ¨è·¨åŸŸé—®é¢˜ï¼‰

![1651029016030](è·¨åŸŸ.assets/1651029016030.png)

æ·»åŠ å“åº”å¤´ï¼ˆæ­£å¸¸è¾“å‡ºï¼‰

![1651030085885](è·¨åŸŸ.assets/1651030085885.png)

mdnæ–‡æ¡£ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS



å¸¸ç”¨HTTPå“åº”å¤´

Access-Control-Allow-Origin è®¾ç½®æºï¼Œå“ªäº›é¡µé¢å¯ä»¥ç»™æˆ‘ä»¬å‘è¯·æ±‚ï¼Œ

Access-Control-Expose-Headersè¿”å›ç»“æœå“ªäº›å¤´ä¿¡æ¯æ˜¯å¯ä»¥æš´éœ²çš„

Access-Control-Max-Ageé¢„è¯·æ±‚çš„ç»“æœç¼“å­˜ã€‚åŠ ä¸€ä¸ªæ—¶é—´ï¼Œè¯¥æ—¶é—´å†…ç›´æ¥å»è¯·æ±‚ï¼Œè€Œä¸ä¼šåšä¸€ä¸ªé¢„æ£€æŸ¥ã€‚

Access-Control-Allow-Credentials è·¨åŸŸè¯·æ±‚æ—¶æ˜¯å¦å¯ä»¥æºå¸¦éªŒè¯ä¿¡æ¯ã€‚

Access-Control-Allow-Methods è®¾ç½®è¯·æ±‚å…è®¸çš„æ–¹æ³•

Access-Control-Allow-Headers å¤´ä¿¡æ¯

#### 2.3 package  ï¼ˆå¯ä»¥ï¼‰

åœ¨package.jsonä¸­åŠ ä¸Šproxyä»£ç†é…ç½®å¤„ç†è·¨åŸŸè¯·æ±‚

`"proxy":"http://localhost:3004"`

==åœ¨å‘é€postè¯·æ±‚æ—¶ï¼Œè®°å¾—åœ¨è¯·æ±‚åé¢åŠ catch(err=>{})==

```js
axios.post('/items', newItem).then((response) => {
  console.log(response);
}).catch(err => {
	
})
```



#### 2.4 ä»£ç†æ’ä»¶ http-proxy-middleware

å®‰è£…ï¼š`npm install http-proxy-middleware --save`

åœ¨srcæ–‡ä»¶ä¸‹é…ç½®`setupProxy.js`æ–‡ä»¶

```js
const { createProxyMiddleware } = require('http-proxy-middleware');
module.exports = function(app) {
  app.use(
    // è¿‡æ»¤æ‹¼æ¥
    '/ajax', //è¯·æ±‚çš„è·¯å¾„ï¼Œä»¥apiå¼€å¤´çš„éƒ½æ˜¯å¼€å§‹è·¯å¾„ /api/center--æŸ¥æ‰¾targetæ‹¼æ¥çš„æ¥å£
    createProxyMiddleware({
      target: 'https://i.maoyan.com/',//è¦è®¿é—®çš„åœ°å€ï¼Œç”¨ä»¥åŒ¹é…æ‹¼æ¥çš„å¤´éƒ¨
      changeOrigin: true,
    })
  );
};
```

#### 2.5 é‡‡ç”¨nodeä½œä¸ºä¸­é—´äºº(Proxyä»£ç†)

æœåŠ¡å™¨ä¹‹é—´ä¸å­˜åœ¨è·¨åŸŸï¼Œé‡‡ç”¨æœåŠ¡å™¨ä»£ç†è½¬å‘è¯·æ±‚æ•°æ®ï¼›



