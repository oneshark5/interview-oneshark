# ES6

## ä¸€ã€é¢ç»æ”¶é›†

1. Promiseå®žçŽ°å¹¶å‘æ•°æŽ§åˆ¶

2. promiseæ€Žä¹ˆæ•èŽ·é”™è¯¯
3. promiseçš„å¹¶å‘è°ƒåº¦
4. es6å½“ä¸­çš„æ•°æ®ç±»åž‹å’Œä½¿ç”¨ï¼ˆBigIntã€Symbolï¼‰
5. es6declassç”¨è¿‡å—   å¯ä»¥è¯´ä¸€ä¸‹es5æ€Žä¹ˆå®žçŽ°ç»§æ‰¿å—ï¼Ÿ å“Ž  ä¸ä¼š
6. æ‰‹æ’•è®¢é˜…å‘å¸ƒè®¾è®¡æ¨¡å¼    ä¸ä¼š
7.  ç®­å¤´å‡½æ•°ä¸Žæ™®é€šå‡½æ•°åŒºåˆ«
8. è§£æž„èµ‹å€¼ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šè¿”å›žä»€ä¹ˆ

## äºŒã€é¢è¯•å®˜ç³»åˆ—

### é—®é¢˜1ï¼šè¯´è¯´varã€letã€constä¹‹é—´çš„åŒºåˆ«

**1. var**

åœ¨ES5ä¸­ï¼Œé¡¶å±‚å¯¹è±¡çš„å±žæ€§å’Œå…¨å±€å˜é‡æ˜¯ç­‰ä»·çš„ï¼Œç”¨`var`å£°æ˜Žçš„å˜é‡æ—¢æ˜¯å…¨å±€å˜é‡ï¼Œä¹Ÿæ˜¯é¡¶å±‚å˜é‡ï¼›

æ³¨æ„ï¼šé¡¶å±‚å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨çŽ¯å¢ƒæŒ‡çš„æ˜¯`window`å¯¹è±¡ï¼Œåœ¨ `Node` æŒ‡çš„æ˜¯`global`å¯¹è±¡ï¼›å³åœ¨æµè§ˆå™¨ä¸­é‡‡ç”¨`var`å£°æ˜Žçš„å˜é‡ä¸ºå…¨å±€å˜é‡ï¼Œæ˜¯é¡¶å±‚windowå¯¹è±¡çš„å±žæ€§ã€‚

```js
var a = 10;
console.log(window.a) // 10
```

- ä½¿ç”¨`var`å£°æ˜Žçš„å˜é‡å­˜åœ¨==å˜é‡æå‡==çš„æƒ…å†µ

- ä½¿ç”¨`var`ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œå¤šæ¬¡å£°æ˜Žï¼ŒåŽé¢å£°æ˜Žçš„å˜é‡ä¼šè¦†ç›–å‰é¢çš„å˜é‡å£°æ˜Ž

- åœ¨å‡½æ•°ä½œç”¨åŸŸä¸­é‡‡ç”¨`var`å£°æ˜Žå˜é‡ï¼Œå˜é‡ä¸ä¼šè¶…è¿‡è¯¥ä½œç”¨åŸŸï¼Œä½†æ˜¯ç›´æŽ¥é‡‡ç”¨`a = 25`èµ‹å€¼ï¼Œåˆ™è¯¥å˜é‡å°±å˜æˆå…¨å±€å˜é‡ã€‚

  ```js
  var a = 20
  function change(){
      var a = 30
  }
  change()
  console.log(a) // 20 
  
  // ä¸é€‚ç”¨var
  var a = 20
  function change(){
     a = 30
  }
  change()
  console.log(a) // 30 
  ```

**2. let**

- æ‰€å£°æ˜Žçš„å˜é‡ï¼Œåªåœ¨`let`å‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆï¼Œ==ä¸å­˜åœ¨å˜é‡æå‡==ã€‚

  ```js
  {
      let a = 20
  }
  console.log(a) // ReferenceError: a is not defined.
  // è‹¥åœ¨æœªå£°æ˜Žä¹‹å‰ä½¿ç”¨ï¼Œåˆ™æŠ¥é”™
  console.log(b) // æŠ¥é”™ReferenceError
  let b = 2
  ```

- æš‚æ—¶æ€§æ­»åŒºï¼šä½¿ç”¨`let`å£°æ˜Žå˜é‡å‰ï¼Œè¯¥å˜é‡éƒ½ä¸å¯ç”¨ï¼›åªè¦å—çº§ä½œç”¨åŸŸå†…å­˜åœ¨`let`å‘½ä»¤ï¼Œè¿™ä¸ªåŒºåŸŸå°±ä¸å†å—å¤–éƒ¨å½±å“ã€‚

  ```js
  // åœ¨å—ä½œç”¨åŸŸä¸­æå‰ä½¿ç”¨äº†aå˜é‡ï¼Œä½†æ˜¯å­˜åœ¨letçš„åœ°æ–¹ä¸ä¼šï¼Œå˜é‡æœªå£°æ˜Žå°±ä¸å¯ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šä½¿ç”¨åˆ°å…¨å±€ä½œç”¨åŸŸä¸­çš„ a
  var a = 123
  if (true) {
      a = 'abc' // ReferenceError
      let a;
  }
  ```

- `let`ä¸å…è®¸åœ¨==ç›¸åŒä½œç”¨åŸŸä¸­==é‡å¤å£°æ˜Žã€‚

  ```js
  // ç›¸åŒä½œç”¨åŸŸä¸­å‡ºçŽ°åŒä¸€å£°æ˜Žæ‰ä¼šæŠ¥é”™ï¼Œåƒè¿™ç§ä¸åŒä½œç”¨åŸŸä¸ä¼šæŠ¥é”™
  let a = 20
  {
      let a = 30
  }
  ```

**3. const**

`const`å£°æ˜Žä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜Žï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜ã€‚å¹¶ä¸”ä¸€æ—¦é‡‡ç”¨`const`å£°æ˜Žå˜é‡ï¼Œå°±å¿…é¡»ç«‹å³åˆå§‹åŒ–ã€‚

```js
const a = 1
a = 3
// TypeError: Assignment to constant variable.
const b;
// SyntaxError: Missing initializer in const declaration
```

- å¦‚æžœä¹‹å‰ç”¨`var`æˆ–`let`å£°æ˜Žè¿‡å˜é‡ï¼Œå†ç”¨`const`å£°æ˜ŽåŒæ ·ä¼šæŠ¥é”™

- `const`å®žé™…ä¸Šä¿è¯çš„å¹¶ä¸æ˜¯å˜é‡çš„å€¼ä¸å¾—æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€æ‰€ä¿å­˜çš„æ•°æ®ä¸å¾—æ”¹åŠ¨

- å¯¹äºŽå¤æ‚ç±»åž‹çš„æ•°æ®ï¼Œå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä¿å­˜çš„åªæ˜¯ä¸€ä¸ªæŒ‡å‘å®žé™…æ•°æ®çš„æŒ‡é’ˆï¼Œ`const`åªèƒ½ä¿è¯è¿™ä¸ªæŒ‡é’ˆæ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸èƒ½ç¡®ä¿æ”¹å˜é‡çš„ç»“æž„ä¸å˜ã€‚ðŸ¦ˆå¦‚æžœæ˜¯å¤æ‚ç±»åž‹ï¼Œ`const`ä¿å­˜çš„æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆæ˜¯ä¸å˜çš„ï¼Œè€Œæ•°æ®è‡ªå·±çš„ç»“æž„æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚

  ```js
  const foo = {};
  
  // ä¸º foo æ·»åŠ ä¸€ä¸ªå±žæ€§ï¼Œå¯ä»¥æˆåŠŸ
  foo.prop = 123;
  foo.prop // 123
  
  // å°† foo æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™
  foo = {}; // TypeError: "foo" is read-only
  ```

**4. åŒºåˆ«**

`var`ã€`let`ã€`const`ä¸‰è€…åŒºåˆ«å¯ä»¥å›´ç»•ä¸‹é¢äº”ç‚¹å±•å¼€ï¼š

- å˜é‡æå‡
- æš‚æ—¶æ€§æ­»åŒº
- å—çº§ä½œç”¨åŸŸ
- é‡å¤å£°æ˜Ž
- ä¿®æ”¹å£°æ˜Žçš„å˜é‡
- ä½¿ç”¨

**å˜é‡æå‡**

`var`å£°æ˜Žçš„å˜é‡å­˜åœ¨å˜é‡æå‡ï¼Œå³å˜é‡å¯ä»¥åœ¨å£°æ˜Žä¹‹å‰è°ƒç”¨ï¼Œå€¼ä¸º`undefined`ã€‚

`let`å’Œ`const`ä¸å­˜åœ¨å˜é‡æå‡ï¼Œå³å®ƒä»¬æ‰€å£°æ˜Žçš„å˜é‡ä¸€å®šè¦åœ¨å£°æ˜ŽåŽä½¿ç”¨ï¼Œå¦åˆ™æŠ¥é”™

**æš‚æ—¶æ€§æ­»åŒº**

`var`ä¸å­˜åœ¨æš‚æ—¶æ€§æ­»åŒº

`let`å’Œ`const`å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºï¼Œåªæœ‰ç­‰åˆ°å£°æ˜Žå˜é‡çš„é‚£ä¸€è¡Œä»£ç å‡ºçŽ°ï¼Œæ‰å¯ä»¥èŽ·å–å’Œä½¿ç”¨è¯¥å˜é‡

ðŸ¦ˆé‡‡ç”¨`let`å’Œ`const`å£°æ˜Žçš„å˜é‡ï¼Œåœ¨å£°æ˜Žä¹‹å‰ä¸å¯ç”¨ã€‚

**å—ä½œç”¨åŸŸ**

`var`ä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸ

`let`å’Œ`const`å­˜åœ¨å—çº§ä½œç”¨åŸŸ

**é‡å¤å£°æ˜Ž**

`var`å…è®¸é‡å¤å£°æ˜Žå˜é‡ï¼›é‡å¤å£°æ˜ŽåŽï¼ŒåŽé¢çš„ä¼šæ›¿ä»£å‰é¢å·²æœ‰çš„å£°æ˜Žã€‚

`let`å’Œ`const`åœ¨åŒä¸€ä½œç”¨åŸŸä¸å…è®¸é‡å¤å£°æ˜Žå˜é‡ã€‚

**ä¿®æ”¹å£°æ˜Žçš„å˜é‡**

`var`å’Œ`let`å¯ä»¥

`const`å£°æ˜Žä¸€ä¸ªåªè¯»çš„å¸¸é‡ã€‚ä¸€æ—¦å£°æ˜Žï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜

**ä½¿ç”¨**

èƒ½ç”¨`const`çš„æƒ…å†µå°½é‡ä½¿ç”¨`const`ï¼Œå…¶ä»–æƒ…å†µä¸‹å¤§å¤šæ•°ä½¿ç”¨`let`ï¼Œé¿å…ä½¿ç”¨`var`

### é—®é¢˜2ï¼šæ•°ç»„æ–°å¢žäº†å“ªäº›æ‰©å±•ï¼Ÿ

**1. æ‰©å±•è¿ç®—ç¬¦**

`...`å°†æ•°ç»„è½¬ä¸ºå‚æ•°åºåˆ—ã€‚

- ä¸»è¦ç”¨äºŽå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸€ä¸ªæ•°ç»„å˜ä¸ºå‚æ•°åºåˆ—ï¼›ðŸ¦ˆæŠŠæ•°ç»„ä¸­çš„å…ƒç´ å–å‡ºï¼ˆè½¬æˆå‚æ•°åºåˆ—ï¼‰ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•°ã€‚

- å¤åˆ¶æ•°ç»„

  æ‰©å±•è¿ç®—ç¬¦ä¼šå…‹éš†ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ï¼Œå¯¹äºŽæ–°æ—§æ•°ç»„æ›´æ”¹è‡ªå·±çš„å…ƒç´ ï¼Œä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„ã€‚

  ðŸ¦ˆæ‰€ä»¥é‡‡ç”¨æ‰©å±•è¿ç®—ç¬¦å¤åˆ¶æ•°ç»„æ—¶ï¼Œæ˜¯åœ¨æ ˆå†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„ç©ºé—´ï¼Œå½¢æˆäº†ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚æ–°æ—§æ•°ç»„äº’è¡¥å¹²æ‰°

  ```js
  const a1 = [1, 2];
  // å†™æ³•ä¸€
  const a2 = [...a1];
  // å†™æ³•äºŒ
  const [...a2] = a1;
  
  // å¤åˆ¶åŽï¼Œæ›´æ”¹å±žä»»ä¸€æ•°ç»„ï¼Œéƒ½ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„
  a1[0] = 5
  console.log(a1) // [5, 2]
  console.log(a2) // [1, 2]
  ```

- å¦‚æžœå°†æ‰©å±•è¿ç®—ç¬¦ç”¨äºŽæ•°ç»„èµ‹å€¼ï¼Œåªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åŽä¸€ä½ï¼Œå¦åˆ™ä¼šæŠ¥é”™

  ```js
  const [first, ...rest] = [1, 2, 3, 4, 5];
  first // 1
  rest  // [2, 3, 4, 5]
  
  // åœ¨ç”¨æ‰©å±•è¿ç®—ç¬¦èµ‹å€¼æ—¶ï¼Œç”¨åœ¨éžæœ€åŽä¸€ä½åˆ™ä¼šæŠ¥é”™
  const [...butLast, last] = [1, 2, 3, 4, 5];
  // æŠ¥é”™
  
  const [first, ...middle, last] = [1, 2, 3, 4, 5];
  // æŠ¥é”™
  ```

- å¯ä»¥å°†å­—ç¬¦ä¸²è½¬ä¸ºçœŸæ­£çš„æ•°ç»„

  ```javascript
  [...'hello']
  // [ "h", "e", "l", "l", "o" ]
  ```



**2. æž„é€ å‡½æ•°æ–°å¢žæ–¹æ³•**

- `Array.from()`

  å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡å’Œå¯éåŽ†`ï¼ˆiterableï¼‰`çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ `ES6` æ–°å¢žçš„æ•°æ®ç»“æž„ `Set` å’Œ `Map`ï¼‰

  ```js
  let arrayLike = {
      '0': 'a',
      '1': 'b',
      '2': 'c',
      length: 3
  };
  let arr2 = Array.from(arrayLike); // ['a', 'b', 'c']
  ```

  è¿˜å¯ä»¥æŽ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åŽçš„å€¼æ”¾å…¥è¿”å›žçš„æ•°ç»„

  ```js
  Array.from([1, 2, 3], (x) => x * x)
  // [1, 4, 9]
  ```

- `Array.of()`

  ðŸ¦ˆå°†å‚æ•°åºåˆ—è½¬ä¸ºæ•°ç»„

  ç”¨äºŽå°†ä¸€ç»„å€¼ï¼Œè½¬æ¢ä¸ºæ•°ç»„

  ```js
  Array.of(3, 11, 8) // [3,11,8]
  ```

  æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œè¿”å›žä¸€ä¸ªç©ºæ•°ç»„

  å½“å‚æ•°åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œå®žé™…ä¸Šæ˜¯æŒ‡å®šæ•°ç»„çš„é•¿åº¦

  å‚æ•°ä¸ªæ•°ä¸å°‘äºŽ 2 ä¸ªæ—¶ï¼Œ`Array()`æ‰ä¼šè¿”å›žç”±å‚æ•°ç»„æˆçš„æ–°æ•°ç»„

  ```js
  Array() // []
  Array(3) // [, , ,]
  Array(3, 11, 8) // [3, 11, 8]
  ```

**3. å®žä¾‹å¯¹è±¡æ–°å¢žæ–¹æ³•**

å…³äºŽæ•°ç»„å®žä¾‹å¯¹è±¡æ–°å¢žçš„æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š

- copyWithin()

  å°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŽŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åŽè¿”å›žå½“å‰æ•°ç»„ã€‚

  å‚æ•°å¦‚ä¸‹ï¼š

  - targetï¼ˆå¿…éœ€ï¼‰ï¼šä»Žè¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æžœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚
  - startï¼ˆå¯é€‰ï¼‰ï¼šä»Žè¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æžœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»Žæœ«å°¾å¼€å§‹è®¡ç®—ã€‚
  - endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºŽæ•°ç»„é•¿åº¦ã€‚å¦‚æžœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»Žæœ«å°¾å¼€å§‹è®¡ç®—ã€‚

  ```js
  [1, 2, 3, 4, 5].copyWithin(0, 3) // å°†ä»Ž 3 å·ä½ç›´åˆ°æ•°ç»„ç»“æŸçš„æˆå‘˜ï¼ˆ4 å’Œ 5ï¼‰ï¼Œå¤åˆ¶åˆ°ä»Ž 0 å·ä½å¼€å§‹çš„ä½ç½®ï¼Œç»“æžœè¦†ç›–äº†åŽŸæ¥çš„ 1 å’Œ 2
  // [4, 5, 3, 4, 5] 
  ```

- find()ã€findIndex()

  `find()`ç”¨äºŽæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜

  å‚æ•°æ˜¯ä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼ŒæŽ¥å—ä¸‰ä¸ªå‚æ•°ä¾æ¬¡ä¸ºå½“å‰çš„å€¼ã€å½“å‰çš„ä½ç½®å’ŒåŽŸæ•°ç»„

  ```js
  [1, 5, 10, 15].find(function(value, index, arr) {
    return value > 9;
  }) // 10
  ```

  ```
  findIndex`è¿”å›žç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æžœæ‰€æœ‰æˆå‘˜éƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›ž`-1
  [1, 5, 10, 15].findIndex(function(value, index, arr) {
    return value > 9;
  }) // 2
  ```

  è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æŽ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›žè°ƒå‡½æ•°çš„`this`å¯¹è±¡ã€‚

  ```js
  function f(v){
    return v > this.age;
  }
  let person = {name: 'John', age: 20};
  [10, 12, 26, 15].find(f, person);    // 26
  ```

- fill()

  ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„

  ```javascript
  ['a', 'b', 'c'].fill(7)
  // [7, 7, 7]
  
  new Array(3).fill(7)
  // [7, 7, 7]
  ```

  è¿˜å¯ä»¥æŽ¥å—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºŽæŒ‡å®šå¡«å……çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®

  ```js
  ['a', 'b', 'c'].fill(7, 1, 2)
  // ['a', 7, 'c']
  ```

  æ³¨æ„ï¼Œå¦‚æžœå¡«å……çš„ç±»åž‹ä¸ºå¯¹è±¡ï¼Œåˆ™æ˜¯æµ…æ‹·è´

- entries()ï¼Œkeys()ï¼Œvalues()

  `keys()`æ˜¯å¯¹é”®åçš„éåŽ†ã€`values()`æ˜¯å¯¹é”®å€¼çš„éåŽ†ï¼Œ`entries()`æ˜¯å¯¹é”®å€¼å¯¹çš„éåŽ†

- includes()

  ç”¨äºŽåˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼ï¼Œè¿”å›žå¸ƒå°”å€¼ï¼Œæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæœç´¢çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º`0`

  å‚æ•°ä¸ºè´Ÿæ•°åˆ™è¡¨ç¤ºå€’æ•°çš„ä½ç½®

  ```js
  [1, 2, 3].includes(2)     // true
  [1, 2, 3].includes(4)     // false
  [1, 2, NaN].includes(NaN) // true
  
  [1, 2, 3].includes(3, 3);  // false
  [1, 2, 3].includes(3, -1); // true
  ```

- flat()ï¼ŒflatMap()

  `flat()`å°†æ•°ç»„æ‰å¹³åŒ–å¤„ç†ï¼Œè¿”å›žä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŽŸæ•°æ®æ²¡æœ‰å½±å“

  `flatMap()`æ–¹æ³•å¯¹åŽŸæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œä¸€ä¸ªå‡½æ•°ç›¸å½“äºŽæ‰§è¡Œ`Array.prototype.map()`ï¼Œç„¶åŽå¯¹è¿”å›žå€¼ç»„æˆçš„æ•°ç»„æ‰§è¡Œ`flat()`æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å›žä¸€ä¸ªæ–°æ•°ç»„ï¼Œä¸æ”¹å˜åŽŸæ•°ç»„

  ```js
  // ç›¸å½“äºŽ [[2, 4], [3, 6], [4, 8]].flat()
  [2, 3, 4].flatMap((x) => [x, x * 2])
  // [2, 4, 3, 6, 4, 8]
  ```

  `flatMap()`æ–¹æ³•è¿˜å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šéåŽ†å‡½æ•°é‡Œé¢çš„`this`

**4. æ•°ç»„çš„ç©ºä½**

æ•°ç»„çš„ç©ºä½æŒ‡ï¼Œæ•°ç»„çš„æŸä¸€ä¸ªä½ç½®æ²¡æœ‰ä»»ä½•å€¼

ES6 åˆ™æ˜¯æ˜Žç¡®å°†ç©ºä½è½¬ä¸º`undefined`ï¼ŒåŒ…æ‹¬`Array.from`ã€æ‰©å±•è¿ç®—ç¬¦ã€`copyWithin()`ã€`fill()`ã€`entries()`ã€`keys()`ã€`values()`ã€`find()`å’Œ`findIndex()`

**5. sort()æŽ’åºç®—æ³•ç¨³å®šæ€§**

å°†`sort()`é»˜è®¤è®¾ç½®ä¸ºç¨³å®šçš„æŽ’åºç®—æ³•ã€‚

### é—®é¢˜3ï¼šå¯¹è±¡æ–°å¢žäº†å“ªäº›æ‰©å±•ï¼Ÿ

**ä¸€ã€å±žæ€§ç®€å†™**

**äºŒã€å±žæ€§åè¡¨è¾¾å¼**

- ES6 å…è®¸å­—é¢é‡å®šä¹‰å¯¹è±¡æ—¶ï¼Œå°†è¡¨è¾¾å¼æ”¾åœ¨æ‹¬å·å†…
- è¡¨è¾¾å¼è¿˜å¯ä»¥ç”¨äºŽå®šä¹‰æ–¹æ³•å
- æ³¨æ„ï¼Œå±žæ€§åè¡¨è¾¾å¼å¦‚æžœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨å°†å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²`[object Object]`

**ä¸‰ã€superå…³é”®å­—**

ES6 åˆæ–°å¢žäº†å¦ä¸€ä¸ªç±»ä¼¼çš„å…³é”®å­—`super`ï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŽŸåž‹å¯¹è±¡ã€‚

**å››ã€æ‰©å±•è¿ç®—ç¬¦**

**äº”ã€å±žæ€§çš„éåŽ†**

ES6 ä¸€å…±æœ‰ 5 ç§æ–¹æ³•å¯ä»¥éåŽ†å¯¹è±¡çš„å±žæ€§ã€‚

- for...inï¼šå¾ªçŽ¯éåŽ†å¯¹è±¡è‡ªèº«çš„å’Œç»§æ‰¿çš„å¯æžšä¸¾å±žæ€§ï¼ˆä¸å« Symbol å±žæ€§ï¼‰
- Object.keys(obj)ï¼šè¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯æžšä¸¾å±žæ€§ï¼ˆä¸å« Symbol å±žæ€§ï¼‰çš„é”®å
- Object.getOwnPropertyNames(obj)ï¼šå›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰å±žæ€§ï¼ˆä¸å« Symbol å±žæ€§ï¼Œä½†æ˜¯åŒ…æ‹¬ä¸å¯æžšä¸¾å±žæ€§ï¼‰çš„é”®å
- Object.getOwnPropertySymbols(obj)ï¼šè¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„æ‰€æœ‰ Symbol å±žæ€§çš„é”®å
- Reflect.ownKeys(obj)ï¼šè¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰é”®åï¼Œä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æžšä¸¾

ä¸Šè¿°éåŽ†ï¼Œéƒ½éµå®ˆåŒæ ·çš„å±žæ€§éåŽ†çš„æ¬¡åºè§„åˆ™ï¼š

- é¦–å…ˆéåŽ†æ‰€æœ‰æ•°å€¼é”®ï¼ŒæŒ‰ç…§æ•°å€¼å‡åºæŽ’åˆ—
- å…¶æ¬¡éåŽ†æ‰€æœ‰å­—ç¬¦ä¸²é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæŽ’åˆ—
- æœ€åŽéåŽ†æ‰€æœ‰ Symbol é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæŽ’

```js
Reflect.ownKeys({ [Symbol()]:0, b:0, 10:0, 2:0, a:0 })
// ['2', '10', 'b', 'a', Symbol()]
```

**å…­ã€å¯¹è±¡æ–°å¢žçš„æ–¹æ³•**

å…³äºŽå¯¹è±¡æ–°å¢žçš„æ–¹æ³•ï¼Œåˆ†åˆ«æœ‰ä»¥ä¸‹ï¼š

- Object.is()
- Object.assign()
- Object.getOwnPropertyDescriptors()
- Object.setPrototypeOf()ï¼ŒObject.getPrototypeOf()
- Object.keys()ï¼ŒObject.values()ï¼ŒObject.entries()
- Object.fromEntries()

### é—®é¢˜4ï¼šå¯¹è±¡æ–°å¢žäº†å“ªäº›æ‰©å±•ï¼Ÿ

**ä¸€ã€å‚æ•°**

- `ES6`å…è®¸ä¸ºå‡½æ•°çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼
- å‡½æ•°çš„å½¢å‚æ˜¯é»˜è®¤å£°æ˜Žçš„ï¼Œä¸èƒ½ä½¿ç”¨`let`æˆ–`const`å†æ¬¡å£°æ˜Ž
- å‚æ•°é»˜è®¤å€¼å¯ä»¥ä¸Žè§£æž„èµ‹å€¼çš„é»˜è®¤å€¼ç»“åˆèµ·æ¥ä½¿ç”¨
- å‚æ•°é»˜è®¤å€¼å¯ä»¥ä¸Žè§£æž„èµ‹å€¼çš„é»˜è®¤å€¼ç»“åˆèµ·æ¥ä½¿ç”¨

**äºŒã€å±žæ€§**

å‡½æ•°çš„lengthå±žæ€§

- `length`å°†è¿”å›žæ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°
- `rest` å‚æ•°ä¹Ÿä¸ä¼šè®¡å…¥`length`å±žæ€§
- å¦‚æžœè®¾ç½®äº†é»˜è®¤å€¼çš„å‚æ•°ä¸æ˜¯å°¾å‚æ•°ï¼Œé‚£ä¹ˆ`length`å±žæ€§ä¹Ÿä¸å†è®¡å…¥åŽé¢çš„å‚æ•°äº†

nameå±žæ€§

- è¿”å›žè¯¥å‡½æ•°çš„å‡½æ•°å

- å¦‚æžœå°†ä¸€ä¸ªå…·åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œåˆ™ `name`å±žæ€§éƒ½è¿”å›žè¿™ä¸ªå…·åå‡½æ•°åŽŸæœ¬çš„åå­—

  ```js
  const bar = function baz() {};
  bar.name // "baz"
  ```

- `Function`æž„é€ å‡½æ•°è¿”å›žçš„å‡½æ•°å®žä¾‹ï¼Œ`name`å±žæ€§çš„å€¼ä¸º`anonymous`

- `bind`è¿”å›žçš„å‡½æ•°ï¼Œ`name`å±žæ€§å€¼ä¼šåŠ ä¸Š`bound`å‰ç¼€

  ```javascript
  function foo() {};
  foo.bind({}).name // "bound foo"
  
  (function(){}).bind({}).name // "bound "
  ```

**ä¸‰ã€ä½œç”¨åŸŸ**

ä¸€æ—¦è®¾ç½®äº†å‚æ•°çš„é»˜è®¤å€¼ï¼Œå‡½æ•°è¿›è¡Œå£°æ˜Žåˆå§‹åŒ–æ—¶ï¼Œå‚æ•°ä¼šå½¢æˆä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸ

ç­‰åˆ°åˆå§‹åŒ–ç»“æŸï¼Œè¿™ä¸ªä½œç”¨åŸŸå°±ä¼šæ¶ˆå¤±ã€‚è¿™ç§è¯­æ³•è¡Œä¸ºï¼Œåœ¨ä¸è®¾ç½®å‚æ•°é»˜è®¤å€¼æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºçŽ°çš„ã€‚

**å››ã€ä¸¥æ ¼æ¨¡å¼**

åªè¦å‡½æ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æž„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°å†…éƒ¨å°±ä¸èƒ½æ˜¾å¼è®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™

**äº”ã€ç®­å¤´å‡½æ•°**

- å¦‚æžœç®­å¤´å‡½æ•°çš„ä»£ç å—éƒ¨åˆ†å¤šäºŽä¸€æ¡è¯­å¥ï¼Œå°±è¦ä½¿ç”¨å¤§æ‹¬å·å°†å®ƒä»¬æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨`return`è¯­å¥è¿”å›žã€‚
- å¦‚æžœè¿”å›žå¯¹è±¡ï¼Œéœ€è¦åŠ æ‹¬å·å°†å¯¹è±¡åŒ…è£¹

æ³¨æ„ç‚¹ï¼š

- å‡½æ•°ä½“å†…çš„`this`å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡
- ä¸å¯ä»¥å½“ä½œæž„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨`new`å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯
- ä¸å¯ä»¥ä½¿ç”¨`arguments`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æžœè¦ç”¨ï¼Œå¯ä»¥ç”¨ `rest` å‚æ•°ä»£æ›¿
- ä¸å¯ä»¥ä½¿ç”¨`yield`å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°

### é—®é¢˜5ï¼šä½ æ˜¯æ€Žä¹ˆç†è§£ES6æ–°å¢žSetã€Mapä¸¤ç§æ•°æ®ç»“æž„çš„ï¼Ÿ

å¦‚æžœè¦ç”¨ä¸€å¥æ¥æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥è¯´

`Set`æ˜¯ä¸€ç§å«åšé›†åˆçš„æ•°æ®ç»“æž„ï¼Œ`Map`æ˜¯ä¸€ç§å«åšå­—å…¸çš„æ•°æ®ç»“æž„

- é›†åˆ
  æ˜¯ç”±ä¸€å †æ— åºçš„ã€ç›¸å…³è”çš„ï¼Œä¸”ä¸é‡å¤çš„å†…å­˜ç»“æž„ã€æ•°å­¦ä¸­ç§°ä¸ºå…ƒç´ ã€‘ç»„æˆçš„ç»„åˆ
- å­—å…¸
  æ˜¯ä¸€äº›å…ƒç´ çš„é›†åˆã€‚æ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªç§°ä½œkey çš„åŸŸï¼Œä¸åŒå…ƒç´ çš„key å„ä¸ç›¸åŒ

åŒºåˆ«ï¼Ÿ

- å…±åŒç‚¹ï¼šé›†åˆã€å­—å…¸éƒ½å¯ä»¥å­˜å‚¨ä¸é‡å¤çš„å€¼
- ä¸åŒç‚¹ï¼šé›†åˆæ˜¯ä»¥[å€¼ï¼Œå€¼]çš„å½¢å¼å­˜å‚¨å…ƒç´ ï¼Œå­—å…¸æ˜¯ä»¥[é”®ï¼Œå€¼]çš„å½¢å¼å­˜å‚¨

**å…³äºŽWeakSetå’ŒWeakMap**

- **WeakSet**

  åˆ›å»º`WeakSet`å®žä¾‹

  ```js
  const ws = new WeakSet();
  ```

  `WeakSet`å¯ä»¥æŽ¥å—ä¸€ä¸ªå…·æœ‰ `Iterable`æŽ¥å£çš„å¯¹è±¡ä½œä¸ºå‚æ•°

  ```js
  const a = [[1, 2], [3, 4]];
  const ws = new WeakSet(a);
  // WeakSet {[1, 2], [3, 4]}
  ```

  åœ¨`API`ä¸­`WeakSet`ä¸Ž`Set`æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š

  - æ²¡æœ‰éåŽ†æ“ä½œçš„`API`
  - æ²¡æœ‰`size`å±žæ€§

  `WeackSet`åªèƒ½æˆå‘˜åªèƒ½æ˜¯å¼•ç”¨ç±»åž‹ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»åž‹çš„å€¼

  ```js
  let ws=new WeakSet();
  
  // æˆå‘˜ä¸æ˜¯å¼•ç”¨ç±»åž‹
  let weakSet=new WeakSet([2,3]);
  console.log(weakSet) // æŠ¥é”™
  
  // æˆå‘˜ä¸ºå¼•ç”¨ç±»åž‹
  let obj1={name:1}
  let obj2={name:1}
  let ws=new WeakSet([obj1,obj2]); 
  console.log(ws) //WeakSet {{â€¦}, {â€¦}}
  ```

  `WeakSet`é‡Œé¢çš„å¼•ç”¨åªè¦åœ¨å¤–éƒ¨æ¶ˆå¤±ï¼Œå®ƒåœ¨ `WeakSet`é‡Œé¢çš„å¼•ç”¨å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±

- **WeakMap**

  `WeakMap`ç»“æž„ä¸Ž`Map`ç»“æž„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºŽç”Ÿæˆé”®å€¼å¯¹çš„é›†åˆ

  åœ¨`API`ä¸­`WeakMap`ä¸Ž`Map`æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š

  - æ²¡æœ‰éåŽ†æ“ä½œçš„`API`
  - æ²¡æœ‰`clear`æ¸…ç©ºæ–¹æ³•

  ```javascript
  // WeakMap å¯ä»¥ä½¿ç”¨ set æ–¹æ³•æ·»åŠ æˆå‘˜
  const wm1 = new WeakMap();
  const key = {foo: 1};
  wm1.set(key, 2);
  wm1.get(key) // 2
  
  // WeakMap ä¹Ÿå¯ä»¥æŽ¥å—ä¸€ä¸ªæ•°ç»„ï¼Œ
  // ä½œä¸ºæž„é€ å‡½æ•°çš„å‚æ•°
  const k1 = [1, 2, 3];
  const k2 = [4, 5, 6];
  const wm2 = new WeakMap([[k1, 'foo'], [k2, 'bar']]);
  wm2.get(k2) // "bar"
  ```

  `WeakMap`åªæŽ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆ`null`é™¤å¤–ï¼‰ï¼Œä¸æŽ¥å—å…¶ä»–ç±»åž‹çš„å€¼ä½œä¸ºé”®å

  ```javascript
  const map = new WeakMap();
  map.set(1, 2)
  // TypeError: 1 is not an object!
  map.set(Symbol(), 2)
  // TypeError: Invalid value used as weak map key
  map.set(null, 2)
  // TypeError: Invalid value used as weak map key
  ```

  `WeakMap`çš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼Œé‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨

  ä¸¾ä¸ªåœºæ™¯ä¾‹å­ï¼š

  åœ¨ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨`WeakMap`ç»“æž„ï¼Œå½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„`WeakMap`è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤

  ```javascript
  const wm = new WeakMap();
  
  const element = document.getElementById('example');
  
  wm.set(element, 'some information');
  wm.get(element) // "some information"
  ```

  æ³¨æ„ï¼š`WeakMap` å¼±å¼•ç”¨çš„åªæ˜¯é”®åï¼Œè€Œä¸æ˜¯é”®å€¼ã€‚é”®å€¼ä¾ç„¶æ˜¯æ­£å¸¸å¼•ç”¨

  ä¸‹é¢ä»£ç ä¸­ï¼Œé”®å€¼`obj`ä¼šåœ¨`WeakMap`äº§ç”Ÿæ–°çš„å¼•ç”¨ï¼Œå½“ä½ ä¿®æ”¹`obj`ä¸ä¼šå½±å“åˆ°å†…éƒ¨

  ```js
  const wm = new WeakMap();
  let key = {};
  let obj = {foo: 1};
  
  wm.set(key, obj);
  obj = null;
  wm.get(key)
  // Object {foo: 1}
  ```

### é—®é¢˜6ï¼šä½ æ˜¯æ€Žä¹ˆç†è§£ES6ä¸­ Promiseçš„ï¼Ÿä½¿ç”¨åœºæ™¯ï¼Ÿ

**ä¸€ã€Promiseæ˜¯ä»€ä¹ˆ**

å¤„ç†å¤šå±‚å¼‚æ­¥æ“ä½œï¼Œå½¢æˆå›žè°ƒåœ°ç‹±ï¼Œé‡‡ç”¨`Promise`

**ç‰¹ç‚¹**

- å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚
- ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æžœã€‚

**ä¼˜ç‚¹**

- é“¾å¼æ“ä½œå‡ä½Žäº†ç¼–ç éš¾åº¦
- ä»£ç å¯è¯»æ€§æ˜Žæ˜¾å¢žå¼º

**ç¼ºç‚¹**

- æ— æ³•å–æ¶ˆ`Promise`ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚
- å¦‚æžœä¸è®¾ç½®å›žè°ƒå‡½æ•°ï¼Œ`Promise`å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚
- å½“å¤„äºŽ`pending`çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚

**æ³¨æ„**

- æ‰§è¡Œå™¨å‡½æ•°åœ¨å†…éƒ¨æ˜¯åŒæ­¥è°ƒç”¨çš„
- 

**äºŒã€ç”¨æ³•**

`Promise`å¯¹è±¡æ˜¯ä¸€ä¸ªæž„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ`Promise`å®žä¾‹

```javascript
const promise = new Promise(function(resolve, reject) {});
```

Promise`æž„é€ å‡½æ•°æŽ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯`resolve`å’Œ`rejectã€‚

- `resolve`å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†`Promise`å¯¹è±¡çš„çŠ¶æ€ä»Žâ€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€
- `reject`å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†`Promise`å¯¹è±¡çš„çŠ¶æ€ä»Žâ€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€

**å®žä¾‹æ–¹æ³•**

- then()
- catch()
- finally()



- then()

  `then`æ˜¯å®žä¾‹çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶çš„å›žè°ƒå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`resolved`çŠ¶æ€çš„å›žè°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯`rejected`çŠ¶æ€çš„å›žè°ƒå‡½æ•°

  `then`æ–¹æ³•è¿”å›žçš„æ˜¯ä¸€ä¸ªæ–°çš„`Promise`å®žä¾‹ï¼Œä¹Ÿå°±æ˜¯`promise`èƒ½é“¾å¼ä¹¦å†™çš„åŽŸå› 

  ```js
  getJSON("/posts.json").then(function(json) {
    return json.post;
  }).then(function(post) {
    // ...
  });
  ```

  

- catch

  `catch()`æ–¹æ³•æ˜¯`.then(null, rejection)`æˆ–`.then(undefined, rejection)`çš„åˆ«åï¼Œç”¨äºŽæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›žè°ƒå‡½æ•°

  ```js
  getJSON('/posts.json').then(function(posts) {
    // ...
  }).catch(function(error) {
    // å¤„ç† getJSON å’Œ å‰ä¸€ä¸ªå›žè°ƒå‡½æ•°è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯
    console.log('å‘ç”Ÿé”™è¯¯ï¼', error);
  });
  ```

  `Promise`å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åŽä¼ é€’ï¼Œç›´åˆ°è¢«æ•èŽ·ä¸ºæ­¢ã€‚

  ```js
  getJSON('/post/1.json').then(function(post) {
    return getJSON(post.commentURL);
  }).then(function(comments) {
    // some code
  }).catch(function(error) {
    // å¤„ç†å‰é¢ä¸‰ä¸ªPromiseäº§ç”Ÿçš„é”™è¯¯
  });
  ```

  ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨`catch`æ–¹æ³•ä»£æ›¿`then()`ç¬¬äºŒä¸ªå‚æ•°

  `Promise`å¯¹è±¡æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šä¼ é€’åˆ°å¤–å±‚ä»£ç ï¼Œå³ä¸ä¼šæœ‰ä»»ä½•ååº”ã€‚

  ```js
  const someAsyncThing = function() {
    return new Promise(function(resolve, reject) {
      // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜Ž
      resolve(x + 2);
    });
  };
  ```

  æµè§ˆå™¨è¿è¡Œåˆ°è¿™ä¸€è¡Œï¼Œä¼šæ‰“å°å‡ºé”™è¯¯æç¤º`ReferenceError: x is not defined`ï¼Œä½†æ˜¯ä¸ä¼šé€€å‡ºè¿›ç¨‹

  `catch()`æ–¹æ³•ä¹‹ä¸­ï¼Œè¿˜èƒ½å†æŠ›å‡ºé”™è¯¯ï¼Œé€šè¿‡åŽé¢`catch`æ–¹æ³•æ•èŽ·åˆ°

- finally()

  `finally()`æ–¹æ³•ç”¨äºŽæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åŽçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ

  ```js
  promise
  .then(result => {Â·Â·Â·})
  .catch(error => {Â·Â·Â·})
  .finally(() => {Â·Â·Â·});
  ```

**æž„é€ å‡½æ•°æ–¹æ³•**

`Promise`æž„é€ å‡½æ•°å­˜åœ¨ä»¥ä¸‹æ–¹æ³•ï¼š

- all()
- race()
- allSettled()
- resolve()
- reject()
- try()

**ä¸‰ã€ä½¿ç”¨åœºæ™¯**

å›¾ç‰‡åŠ è½½



### é—®é¢˜7ï¼šPromiseå„ç§æ‰‹å†™ï¼Ÿ

### å…³äºŽPromise

### ä¸€ã€çŸ¥è¯†ç‚¹

#### 1. å®šä¹‰

`Promise`å¯¹è±¡ç”¨äºŽè¡¨ç¤ºä¸€ä¸ª**å¼‚æ­¥æ“ä½œ**çš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–è€…å¤±è´¥ï¼‰åŠå…¶ç»“æžœå€¼ï¼Œæ˜¯å¼‚æ­¥å˜æˆçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆï¼ˆå›žè°ƒå‡½æ•°å’Œäº‹ä»¶ï¼‰æ›´åˆç†ã€æ›´å¼ºå¤§ã€‚ES6 å°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œç»Ÿä¸€ç”¨æ³•ï¼Œæä¾›äº†åŽŸç”Ÿçš„`Promise`å¯¹è±¡ã€‚

å®ƒå¯ä»¥æŠŠå¼‚æ­¥æ“ä½œæœ€ç»ˆçš„æˆåŠŸè¿”å›žå€¼æˆ–å¤±è´¥åŽŸå› å’Œç›¸åº”çš„å¤„ç†ç¨‹åºå…³è”èµ·æ¥ã€‚è¿™æ ·ï¼Œå¼‚æ­¥æ–¹æ³•å¹¶ä¸ä¼šç«‹å³è¿”å›žæœ€ç»ˆçš„å€¼ï¼Œè€Œæ˜¯ä¼šè¿”å›žä¸€ä¸ª`Promise`ã€‚

ä¸€ä¸ª`Promise`å¿…ç„¶å¤„äºŽä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š

- `pending`ï¼šåˆå§‹çŠ¶æ€ï¼Œæœªè¢«å…‘çŽ°ï¼Œä¹Ÿæœªè¢«æ‹’ç»
- `fulfilled`ï¼šå·²å…‘çŽ°ï¼Œæ“ä½œå®Œæˆ
- `rejected`ï¼šå·²æ‹’ç»ï¼Œæ“ä½œå¤±è´¥

#### 2. åŸºæœ¬ä½¿ç”¨

`Promise`å¯¹è±¡ï¼Œé€šè¿‡`new`æ“ä½œç¬¦æ¥å®Œæˆ`Promise`çš„å®žä¾‹åŒ–ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚`Promise`çš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œåªèƒ½åœ¨å†…éƒ¨è¿›è¡Œæ“ä½œã€‚åœ¨ä¼ å…¥çš„å‡½æ•°ä¸­ï¼ŒæŽ§åˆ¶`Promise`çš„çŠ¶æ€è½¬æ¢æ˜¯é€šè¿‡è°ƒç”¨å®ƒçš„ä¸¤ä¸ªå‡½æ•°å‚æ•°å®žçŽ°çš„ï¼Œé€šå¸¸å‘½åä¸º`resolve()`å’Œ`reject()`ã€‚è°ƒç”¨`resolve()`å°†çŠ¶æ€è½¬æ¢ä¸º`fulfilled`ï¼Œè°ƒç”¨`reject()`å°†çŠ¶æ€è½¬æ¢ä¸º`rejected`ã€‚å¦å¤–ï¼Œè°ƒç”¨`reject()`å°†**æŠ›å‡ºé”™è¯¯**ã€‚

```js
new Promise((resolve, reject) => {
    const a = 1;
    if (a === 1) {
        resolve('fulfilled');
    } else {
        reject('rejected');
    }
}).then(
    fulfilledValue => console.log(fulfilledValue),
    rejectedValue => console.log(rejectedValue)
);
// fulfilled
```

ä»£ç ä¸­ï¼Œé€šè¿‡newåˆ›å»ºPromiseå®žä¾‹ï¼ŒæŽ¥æ”¶äº†ä¸€ä¸ªç®­å¤´å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°æŽ¥æ”¶`resolve()`å’Œ`reject()`ä¸¤ä¸ªå‚æ•°ï¼Œæ ¹æ®åˆ¤æ–­æ”¹å˜çŠ¶æ€ï¼Œåœ¨`Promise`åŽï¼Œè°ƒç”¨äº†`then`æ–¹æ³•ï¼Œ`then`æ–¹æ³•æŽ¥æ”¶`onResolved`å’Œ`onRejected`ä¸¤ä¸ªå¤„ç†ç¨‹åºï¼Œåˆ†åˆ«å¯¹æˆåŠŸå’Œå¤±è´¥çš„Promiseè¿›è¡Œå¤„ç†ã€‚

å¦‚æžœ`Promise`å†…éƒ¨æŠ›å‡ºé”™è¯¯ï¼Œ`then`æ–¹æ³•ä¼šæ‰§è¡Œç¬¬äºŒä¸ªå¤„ç†ç¨‹åº`onReject`ã€‚

```js
new Promise(() => {
  throw 'error'
}).then(null, error => console.log(error));
// error
```

#### 3. åŽŸåž‹æ–¹æ³•

**1. Promise.prototype.then()**

ä½œç”¨æ˜¯ä¸º`Promise`å®žä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›žè°ƒå‡½æ•°ã€‚

`then()`æ–¹æ³•è¿”å›žä¸€ä¸ªæ–°çš„`Promise`ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå®ƒ**æœ€å¤š**éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š`Promise`çš„**æˆåŠŸ**å’Œ**å¤±è´¥**çš„å›žè°ƒå‡½æ•°ã€‚å› ä¸º`Promise`åªèƒ½è½¬æ¢ä¸€æ¬¡çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå‡½æ•°ä¸€å®šæ˜¯**äº’æ–¥**çš„ã€‚

`then`æ–¹æ³•æ”¯æŒ**é“¾å¼è°ƒç”¨**ã€‚

==è¿”å›žä¸€ä¸ªæ–°çš„`Promise`==ï¼Œè¿™ä¸ªæ–°`Promise`åŸºäºŽ`onResolved`å¤„ç†ç¨‹åºçš„è¿”å›žå€¼æž„å»ºï¼Œå³ä¼šé€šè¿‡`Promise.resolved()`åŒ…è£…æ¥ç”Ÿæˆæ–°`Promise()`ã€‚--ã€‹ä¸ç®¡æ˜¯`onResolved`è¿˜æ˜¯`onReject`éƒ½ä¼šè¢«`Promise.resolve()`åŒ…è£…ã€‚

å…·ä½“æƒ…å†µå¦‚ä¸‹ï¼Œå¦‚æžœ`then`ä¸­çš„å›žè°ƒå‡½æ•°ï¼š

- æ²¡æœ‰æ˜¾ç¤ºçš„è¿”å›žå€¼ï¼Œè¢«`Promise.resolve()`åŒ…è£…ï¼Œ`then`è¿”å›žçš„`Promise`æ˜¯`fulfilled`çŠ¶æ€ï¼Œå¹¶ä¸”`fulfilled`çŠ¶æ€çš„å›žè°ƒå‡½æ•°å‚æ•°å€¼æ˜¯`undefined`ã€‚

  å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œç”±äºŽç¬¬ä¸€ä¸ª`then`æ²¡æœ‰è¿”å›žä»»ä½•å€¼ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª`then`çš„ç¬¬ä¸€ä¸ªå›žè°ƒå‡½æ•°çš„å‚æ•°æ˜¯`undefined`ã€‚

  ```js
  new Promise((resolve, reject) => {
      resolve(1);
      // reject(-1);
  })
      .then(value => {
          console.log('fulfilledValue', value);
      })
      .then(
          res => {
              console.log('fulfilledValue', res);
          },
          res => {
              console.log('rejectedValue', res);
          }
      );
  // fulfilledValue 1
  // fulfilledValue undefined
  ```

- è¿”å›žäº†ä¸€ä¸ª**å€¼**ï¼Œé‚£ä¹ˆ`then`è¿”å›žçš„`Promise`æ˜¯`fulfilled`çŠ¶æ€ï¼Œå¹¶å°†**è¿”å›žçš„å€¼**ä½œä¸º`fulfilled`çŠ¶æ€çš„å›žè°ƒå‡½æ•°å‚æ•°å€¼ã€‚---ã€‹ç›´æŽ¥å°†å€¼åŒ…è£…æˆæˆåŠŸçŠ¶æ€ï¼Œ

  å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œæœ€åˆçš„`Promise`çŠ¶æ€æ˜¯`fulfilled`ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ª`then`æ–¹æ³•è°ƒç”¨ç¬¬ä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼Œå…ˆæ‰“å°å‡º`1`ï¼Œåˆè¿”å›žäº†`'Jack'`ï¼Œé‚£ä¹ˆè¯¥`then`è¿”å›žçš„`Promise`ä¹Ÿæ˜¯`fulfilled`çŠ¶æ€ï¼Œå¹¶ä¸”å°†`'Jack'`ä½œä¸ºç¬¬äºŒä¸ª`then`æ–¹æ³•çš„å›žè°ƒå‡½æ•°å‚æ•°ã€‚

  ```js
  new Promise((resolve, reject) => {
      resolve(1);
      // reject(-1);
  })
      .then(value => {
          console.log('fulfilledValue', value);
          return 'Jack';
      })
      .then(
          res => {
              console.log('fulfilledValue', res);
          },
          res => {
              console.log('rejectedValue', res);
          }
      );
  // fulfilledValue 1
  // fulfilledValue Jack
  ```

  æŠŠPromiseæ”¹ä¸º`rejected`ï¼Œä¹Ÿä¸€æ ·

- æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆ`then`è¿”å›žçš„`Promise`æ˜¯`rejected`çŠ¶æ€ï¼Œå¹¶å°†**æŠ›å‡ºçš„é”™è¯¯**ä½œä¸º`fulfilled`çŠ¶æ€çš„å›žè°ƒå‡½æ•°å‚æ•°å€¼ã€‚--ã€‹ä¹Ÿæ˜¯`Promise.resolve()`åŒ…è£…çš„ç»“æžœã€‚

  ```js
  new Promise((resolve, reject) => {
      resolve(1);
      // reject(-1);
  })
      .then(value => {
          console.log('fulfilledValue', value);
          throw 'Error!';
      })
      .then(
          res => {
              console.log('fulfilledValue', res);
          },
          res => {
              console.log('rejectedValue', res);
          }
      );
  // fulfilledValue 1
  // rejectedValue Error!
  ```

- è¿”å›žä¸€ä¸ª`Promise`ï¼Œä¸ç®¡æ˜¯`fulfilled`è¿˜æ˜¯`rejected`ï¼Œéƒ½åˆ†åˆ«ä¼šæŽ¥æ”¶å‰é¢`Promise`æˆåŠŸã€å¤±è´¥çš„çŠ¶æ€ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†è‡ªå·±æ‰§è¡Œçš„ç»“æžœä½œä¸ºå‚æ•°è¿”å›žï¼Œä¼ ç»™ä¸‹ä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼Œæ‰§è¡Œ`onreSolved`æˆ–`onRejected`å¤„ç†ç¨‹åºã€‚ä»¥`fulfilled`çŠ¶æ€ä¸ºä¾‹ã€‚

  ```js
  new Promise((resolve, reject) => {
      resolve(1);
      // reject(-1);
  })
      .then(value => {
          console.log('fulfilledValue', value);
          return Promise.resolve('fulfilled');
      })
      .then(
          res => {
              console.log('fulfilledValue', res);
          },
          res => {
              console.log('rejectedValue', res);
          }
      );
  // fulfilledValue 1
  // fulfilledValue fulfilled
  ```

- å¦‚æžœæœ€åˆçš„`Promise`æ˜¯`rejected`çŠ¶æ€ï¼Œä¸”ç¬¬ä¸€ä¸ª`then`æ²¡æœ‰ç¬¬äºŒä¸ªå‡½æ•°å‚æ•°ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ª`then`å°±ä¼šæ‰§è¡Œå…¶ç¬¬äºŒä¸ªå›žè°ƒå‡½æ•°ï¼Œå¹¶ä¸”å‚æ•°ä¸ºæœ€åˆ`Promise`çš„`reject`ä¸­çš„å‚æ•°ã€‚-->ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªthençš„`onRejected`å¤„ç†ç¨‹åºæ²¡æœ‰æ‰§è¡Œï¼Œä¼šåŽŸæ ·å‘åŽä¼ ï¼ŒåŽé¢çš„thenæ‰§è¡Œå¤„ç†ç¨‹åºï¼Œå¯¹å¤±è´¥çš„çŠ¶æ€è¿›è¡Œå¤„ç†ã€‚

  ```javascript
  new Promise((resolve, reject) => {
      // resolve(1);
      reject(-1);
  })
      .then(value => {
          console.log('fulfilledValue', value);
      })
      .then(null, res => {
          console.log('rejectedValue', res);
      });
  // rejectedValue -1
  ```

- è‹¥è°ƒç”¨`then`æ—¶ä¸åšä»»ä½•å¤„ç†ï¼Œä¸ä¼ å¤„ç†ç¨‹åºï¼Œåˆ™åŽŸæ ·å‘åŽä¼ ;

  ```js
  new Promise((resolve, reject) => {
    resolve(1)
  }).then()
    .then(value => {
    console.log('fulfilledValue', value)
  })
  // fulfilledValue 1
  ```

**2. Promise.prototype.catch()**

`Promise.prototype.catch()`æ–¹æ³•ç”¨äºŽç»™`Promise`æ·»åŠ æ‹’ç»å¤„ç†ç¨‹åºã€‚è¿™ä¸ªæ–¹æ³•åªæŽ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š`onRejected`å¤„ç†ç¨‹åºã€‚å®ƒçš„è¡Œä¸ºä¸Žè°ƒç”¨`Promise.prototype.then(undefined, onRejected)`ç›¸åŒã€‚

å¦‚ä¸‹ä»£ç ï¼Œä¸¤ç§ç­‰ä»·çš„å†™æ³•ã€‚

```javascript
new Promise((resolve, reject) => {
    reject('error');
}).catch(error => console.log(error));
// error
new Promise((resolve, reject) => {
    reject('error');
}).then(null, error => console.log(error));
// error
```